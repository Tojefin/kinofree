<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<link rel="shortcut icon" href="assets/img/favicon.ico" type="image/x-icon">
	<link rel="stylesheet" href="assets/css/style.css">
	<link rel="preconnect" href="https://fonts.googleapis.com">
	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;700&display=swap" rel="stylesheet">
	<title>KinoFree</title>
</head>
<body>
<div class="main">
	<div class="container">
			
		<a href="/"><h1 class="title">KinoFree</h1></a>
		<text class="subtitle">Смотрите кино бесплатно</text>

		<div class="form" id="search-form">
			<svg class="u-svg-content" viewBox="0 0 512 512" x="0px" y="0px" id="svg-d182" style="width: 33px;height: 32px;margin-left: 10px;fill: #777;">
				<path d="M505.749,475.587l-145.6-145.6c28.203-34.837,45.184-79.104,45.184-127.317c0-111.744-90.923-202.667-202.667-202.667    S0,90.925,0,202.669s90.923,202.667,202.667,202.667c48.213,0,92.48-16.981,127.317-45.184l145.6,145.6    c4.16,4.16,9.621,6.251,15.083,6.251s10.923-2.091,15.083-6.251C514.091,497.411,514.091,483.928,505.749,475.587z     M202.667,362.669c-88.235,0-160-71.765-160-160s71.765-160,160-160s160,71.765,160,160S290.901,362.669,202.667,362.669z"/>
			</svg>
			<input type="text" placeholder="Название фильма" id="search-title" name="title" class="search">
			<input type="button" value="Найти" id="search" class="button">
		</div>

		<div id="player"></div>
		<div id="search-list" class="search-list"></div>

	</div>

</div>
<div class="menu">

</div>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
<script>
    document.addEventListener('DOMContentLoaded', function () {

        var search = document.querySelector('#search');
        var title = document.querySelector('#search-title');

				if (search) {
            search.addEventListener('click', function () {
							$(".listBlock").remove();
                return kp_parse();
								console.log(title);
            });
        }

        if (title) {
            title.addEventListener('keyup', function (event) {
                event.preventDefault();
                if (event.keyCode === 13) {
									$(".listBlock").remove();
                    return kp_parse();
										console.log(title);
                }
            });
        }

			 	async function kp_parse() {
					let url = ('https://kinopoiskapiunofficial.tech/api/v2.1/films/search-by-keyword?keyword=' + title.value + '&page=1');
					let response = await fetch(url , {
						method: 'GET',
						headers: {
							"Content-Type": "application/json",
							"X-API-KEY": "4b12f46d-638b-4bac-bf06-33865d3a3524",
						},
					});
					if (response.ok) {
					  let data = await response.json();
					  console.log(data);
						$(data.films).each(function(index, item) {
						  $('#search-list').append(
								'<div class="listBlock"><img onclick="parse('+item.filmId+')" src="'+ item.posterUrl +'" width="20%" height="20%"><text class="listName">' + item.nameRu + '</text><text class="listDesc">' + item.description + '</text><text class="listYear">' + item.year + '</text><text class="listRating">' + item.rating + '</text></div>');
						});
					} else {
					  alert('error', response.status);
					}
				}
    });
</script>
<script>
function parse(id) {
		$(".search-list").remove();
		$("#search-form").remove();
		$('#player').append('<iframe src="https://apilordfilms-s.tobaco.ws/embed/kp/'+id+'" allow="autoplay *" width="500" height="300" allowfullscreen="" webkitallowfullscreen="" mozallowfullscreen="" oallowfullscreen="" msallowfullscreen=""></iframe>');
}
</script>

</body>
</html>
