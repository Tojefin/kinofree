import{s as Y,r as Z,c as x,b as ee}from"./scheduler.hW0JTbzp.js";import{S as te,i as se,e as b,k as N,s as V,c as v,a as C,l as q,d,f as $,m as le,n as g,o as A,g as z,h as m,p as O,q as K,r as I,u as P,v as R,w as H,x as ne,t as re,b as ae,j as ie}from"./index.e_G28YpI.js";import{o as oe,L as ue,e as M}from"./_options.tPRrJWu5.js";import{a as fe,g as ce}from"./entry.x9MpmCS7.js";import{C as he,A as pe,v as me}from"./watchPlayer.svelte_svelte_type_style_lang.Qx0ZRggo.js";import{p as _e}from"./stores.cosLrAgG.js";let ge="https://kinopoiskapiunofficial.tech/api/v2.1/films/search-by-keyword";async function de(a,n=1){return a?await(await fetch(`${ge}?keyword=${a}&page=${n}`,oe)).json():[]}function Q(a,n,e){const l=a.slice();return l[17]=n[e].title,l[18]=n[e].id,l}function W(a){let n,e=M(a[0].list),l=[];for(let r=0;r<e.length;r+=1)l[r]=X(Q(a,e,r));return{c(){n=b("ul");for(let r=0;r<l.length;r+=1)l[r].c();this.h()},l(r){n=v(r,"UL",{class:!0});var s=C(n);for(let t=0;t<l.length;t+=1)l[t].l(s);s.forEach(d),this.h()},h(){g(n,"class","suggest svelte-695j9b")},m(r,s){z(r,n,s);for(let t=0;t<l.length;t+=1)l[t]&&l[t].m(n,null)},p(r,s){if(s&1){e=M(r[0].list);let t;for(t=0;t<e.length;t+=1){const f=Q(r,e,t);l[t]?l[t].p(f,s):(l[t]=X(f),l[t].c(),l[t].m(n,null))}for(;t<l.length;t+=1)l[t].d(1);l.length=e.length}},d(r){r&&d(n),ne(l,r)}}}function X(a){let n,e,l=a[17]+"",r,s,t;return{c(){n=b("a"),e=b("li"),r=re(l),s=V(),this.h()},l(f){n=v(f,"A",{href:!0});var i=C(n);e=v(i,"LI",{class:!0});var h=C(e);r=ae(h,l),h.forEach(d),s=$(i),i.forEach(d),this.h()},h(){g(e,"class","svelte-695j9b"),g(n,"href",t=`/search?key=${a[17]}`)},m(f,i){z(f,n,i),m(n,e),m(e,r),m(n,s)},p(f,i){i&1&&l!==(l=f[17]+"")&&ie(r,l),i&1&&t!==(t=`/search?key=${f[17]}`)&&g(n,"href",t)},d(f){f&&d(n)}}}function be(a){let n,e,l,r,s,t,f,i,h,D,j=a[2]&&a[0].list.length&&a[3].trim().length>2,T,_,k,F="Найти",S,w,U,y,c,B;r=new ue({}),h=new he({props:{small:!0}});let u=j&&W(a);return w=new pe({props:{circle:!0}}),{c(){n=b("div"),e=b("div"),l=b("div"),N(r.$$.fragment),s=V(),t=b("input"),f=V(),i=b("button"),N(h.$$.fragment),D=V(),u&&u.c(),T=V(),_=b("button"),k=b("p"),k.textContent=F,S=V(),N(w.$$.fragment),this.h()},l(o){n=v(o,"DIV",{class:!0});var p=C(n);e=v(p,"DIV",{class:!0});var E=C(e);l=v(E,"DIV",{class:!0});var G=C(l);q(r.$$.fragment,G),G.forEach(d),s=$(E),t=v(E,"INPUT",{type:!0,placeholder:!0,class:!0}),f=$(E),i=v(E,"BUTTON",{class:!0});var J=C(i);q(h.$$.fragment,J),J.forEach(d),D=$(E),u&&u.l(E),E.forEach(d),T=$(p),_=v(p,"BUTTON",{class:!0});var L=C(_);k=v(L,"P",{class:!0,"data-svelte-h":!0}),le(k)!=="svelte-173t95q"&&(k.textContent=F),S=$(L),q(w.$$.fragment,L),L.forEach(d),p.forEach(d),this.h()},h(){g(l,"class","loupe svelte-695j9b"),g(t,"type","text"),g(t,"placeholder","Фильм или сериал"),g(t,"class","svelte-695j9b"),g(i,"class","clear svelte-695j9b"),A(i,"canClear",a[3]),g(e,"class","input svelte-695j9b"),A(e,"inputFocus",a[2]),A(e,"inputValue",a[3].length&&!a[2]),g(k,"class","svelte-695j9b"),g(_,"class","search svelte-695j9b"),_.disabled=U=!(a[3].trim().length>0),g(n,"class","searchBar svelte-695j9b")},m(o,p){z(o,n,p),m(n,e),m(e,l),O(r,l,null),m(e,s),m(e,t),K(t,a[3]),a[12](t),m(e,f),m(e,i),O(h,i,null),m(e,D),u&&u.m(e,null),m(n,T),m(n,_),m(_,k),m(_,S),O(w,_,null),y=!0,c||(B=[I(t,"focus",a[9]),I(t,"blur",a[10]),I(t,"keydown",a[8]),I(t,"keyup",a[7]),I(t,"input",a[11]),I(i,"click",a[5]),I(_,"pointerdown",a[13])],c=!0)},p(o,[p]){p&8&&t.value!==o[3]&&K(t,o[3]),(!y||p&8)&&A(i,"canClear",o[3]),p&13&&(j=o[2]&&o[0].list.length&&o[3].trim().length>2),j?u?u.p(o,p):(u=W(o),u.c(),u.m(e,null)):u&&(u.d(1),u=null),(!y||p&4)&&A(e,"inputFocus",o[2]),(!y||p&12)&&A(e,"inputValue",o[3].length&&!o[2]),(!y||p&8&&U!==(U=!(o[3].trim().length>0)))&&(_.disabled=U)},i(o){y||(P(r.$$.fragment,o),P(h.$$.fragment,o),P(w.$$.fragment,o),y=!0)},o(o){R(r.$$.fragment,o),R(h.$$.fragment,o),R(w.$$.fragment,o),y=!1},d(o){o&&d(n),H(r),a[12](null),H(h),u&&u.d(),H(w),c=!1,Z(B)}}}function ve(a,n,e){let l;x(a,_e,c=>e(16,l=c));let r,s={select:-1,list:[]},t,f=!1,i="";function h(c){e(2,f=c)}function D(){e(3,i=""),t.focus()}function j(){i.trim()&&ce("./search?key="+encodeURIComponent(i))}let T=null;function _(c){c.key=="ArrowUp"||c.key=="ArrowDown"||i.trim().length<3||(T&&clearTimeout(T),e(0,s.select=-1,s),T=setTimeout(async()=>{let{films:B}=await de(i);B?e(0,s.list=B.map(u=>({title:`${u.nameRu||u.nameEn} ${u.year||""}`,id:u.filmId})).slice(0,5),s):e(0,s.list=[],s),e(0,s.list[-1]={title:i},s)},400))}function k(c){c.key=="Enter"&&j(),c.key=="ArrowUp"&&s.list.length>0&&s.select>-1&&(e(0,s.select--,s),e(3,i=s.list[s.select].title)),c.key=="ArrowDown"&&s.list.length>0&&s.select+1<s.list.length&&(e(0,s.select++,s),e(3,i=s.list[s.select].title))}fe(()=>{r=Object.fromEntries(l.url.searchParams),r.key&&e(3,i=r.key)});const F=()=>h(!0),S=()=>setTimeout(()=>h(!1),100);function w(){i=this.value,e(3,i)}function U(c){ee[c?"unshift":"push"](()=>{t=c,e(1,t)})}return[s,t,f,i,h,D,j,_,k,F,S,w,U,()=>{me(),j()}]}class Te extends te{constructor(n){super(),se(this,n,ve,be,Y,{})}}export{Te as S,de as s};
