function createSliders(){var e=document.getElementById("years-slider");noUiSlider.create(e,{start:[1950,2022],tooltips:[!0,!0],connect:!0,range:{min:[1950,1],max:[2022,1]},format:{to:function(e){return"Год "+e},from:function(e){return e}},pips:{mode:"count",values:5,density:2}});var t=document.getElementById("rating-slider");noUiSlider.create(t,{start:[0,10],tooltips:[!0,!0],connect:!0,range:{min:[0,1],max:[10,1]},format:{to:function(e){return"Рейтинг "+e},from:function(e){return e}},pips:{mode:"count",values:11,density:5}})}try{createSliders()}catch(e){}function toggleFilters(){document.querySelector(".search__form").classList.toggle("search__form--open")}function popupShow(e){const t=document.querySelector(".popup-container");if(!t)return console.log("Контейнер не найден");t.addEventListener("click",(function(e){e.target==t&&popupShow()}));const n=document.querySelector("#popups");return n?e&&(t.innerHTML=n.content.querySelector("#"+e).outerHTML,window.location.hash="popup",t.classList.contains("popup-container--active"))?void 0:(t.classList.contains("popup-container--active")&&history.replaceState("",document.title,window.location.pathname+window.location.search),t.classList.toggle("popup-container--active")):console.log("Шаблоны не найдены")}function preSearch(){let e;if(document.querySelector(".search__form").classList.contains("search__form--open")){let t=[];document.querySelectorAll("input[type=checkbox]:checked").forEach((e=>{t=""==t?e.value:t+","+e.value}));let n=document.getElementById("sorting").value,a=document.getElementById("film-type").value,r=document.getElementById("years-slider").noUiSlider.get(!0),i=document.getElementById("rating-slider").noUiSlider.get(!0);e=`search?genr=${t}&sort=${n}&type=${a}&years=${r}&rating=${i}`}else{e=`search?keyword=${document.querySelector("#search-title").value}`}searchStart(e)}function searchStart(e){if("/search"==location.pathname){let t=new URL(e,window.location.origin);window.history.replaceState({},"",t),window.scrollTo(0,0),search()}else location.href=e}async function search(){section=document.querySelector(".result"),nav=section.querySelector(".result__nav"),container=section.querySelector(".result__list"),container.innerHTML='\n    <div class="card__loading"></div>\n    <div class="card__loading"></div>\n    <div class="card__loading"></div>\n    <div class="card__loading"></div>\n  ';let e=getUrlVars();switch(e.page||(e.page=1),e[0]){case"keyword":var t="https://kinopoiskapiunofficial.tech/api/v2.2/films?keyword="+e.keyword+"&page="+e.page;document.querySelector("#search-title").value=decodeURI(e.keyword);break;case"genr":e.genr=e.genr.split(","),e.rating=e.rating.split(","),e.years=e.years.split(",");t="https://kinopoiskapiunofficial.tech/api/v2.2/films?genres="+e.genr+"&order="+e.sort+"&type="+e.type+"&ratingFrom="+e.rating[0]+"&ratingTo="+e.rating[1]+"&yearFrom="+e.years[0]+"&yearTo="+e.years[1]+"&page="+e.page;break;case"popular":t="https://kinopoiskapiunofficial.tech/api/v2.2/films/top?type=TOP_100_POPULAR_FILMS&page="+e.page;break;case"premiers":let a=new Date,r=["JANUARY","FEBRUARY","MARCH","APRIL","MAY","JUNE","JULY","AUGUST","SEPTEMBER","OCTOBER","NOVEMBER","DECEMBER"][a.getMonth()];t="https://kinopoiskapiunofficial.tech/api/v2.2/films/premieres?year=20"+a.getYear().toString().substring(1)+"&month="+r;break;case"id":if("similars"==e.type)var n="2";else n="1";t=`https://kinopoiskapiunofficial.tech/api/v2.${n}/films/${e.id}/${e.type}`}let a=await apiReq(t);if(container.innerHTML="","Error"==a)return container.innerHTML+='\n      <div>\n        <h2 class="card__title">Ничего не найдено</h2>\n        <p class="card__other">Попробуйте изменить запрос</p>\n      </div>\n    ',void(nav.innerHTML="");a=a.films??a.items,a.forEach((e=>{if(e.genres){var t="";e.genres.forEach((e=>{t=`${t}${e.genre} `}))}if(e.relationType)if("SEQUEL"==e.relationType)var n="Продолжение";else if("PREQUEL"==e.relationType)n="Предыстория";var a=e.kinopoiskId??e.filmId,r=e.nameRu??e.nameOriginal??"-",i=`\n      <a href="/watch?id=${a}"><h2 class="card__title" title="${r}">${r}</h2></a>\n    `,o=`\n      <small class="card__year">${o=e.premiereRu??e.year??"-"}</small>\n    `,c=`\n      <small class="card__rating">${c=e.ratingKinopoisk??e.rating??e.ratingImdb??"-"}</small>\n    `,l=`\n      <p class="card__desc">${e.description??t??n??"-"}</p>\n    `;container.innerHTML+=`\n      <div class="card">\n        <a href="/watch?id=${a}"><img class="card__img" loading="lazy" src="${e.posterUrlPreview}"></a>\n        <div class="card__info">\n          ${i}\n          ${o}\n          ${c}\n          ${l}\n        </div>\n      </div>\n    `}));var r=+e.page-1,i=+e.page+1;if(1==e.page){getUrlVars().page?nav.innerHTML=`<p>Страница ${e.page}</p> <input class="button result__button" type="button" value=">" onclick="searchStart('search${location.search.replace("&page="+e.page,"&page="+i)}')">`:nav.innerHTML=`<p>Страница ${e.page}</p> <input class="button result__button" type="button" value=">" onclick="searchStart('search${location.search}&page=2')">`}else nav.innerHTML=`<input class="button result__button" type="button" value="<" onclick="searchStart('search${location.search.replace("&page="+e.page,"&page="+r)}')"> <p>Страница ${e.page}</p> <input class="button result__button" type="button" value=">" onclick="searchStart('search${location.search.replace("&page="+e.page,"&page="+i)}')">`}function selectOnChange(e,t,n){t!=n&&("filmState"==e.id&&selectChangeValue(e,0,!0),"playerUsed"==e.id&&loadPlayer())}function selectOption(e){let t=e.parentNode.parentNode;selectChangeValue(document.querySelector(`select#${t.id}`),e.value),selectToggle(t)}function selectChangeValue(e,t,n){oldvalue=e.value;let a=document.querySelector(`div#${e.id}`);a&&(a.value=t,a.querySelector("span").innerText=a.querySelectorAll("li")[t].innerText),e.value=t,n||selectOnChange(e,t,oldvalue)}function selectToggle(e){let t=e.querySelector("ul"),n=e.querySelector("span").classList[0];if(t.classList.toggle(`${t.classList[0]}--open`),t.classList.contains(`${t.classList[0]}--open`)){let a="";document.querySelector(`select#${e.id}`).querySelectorAll("option").forEach(((t,r)=>{a=r==e.value?`${a}<li class="${n}__item ${n}__item--active" value="${r}" onclick="selectOption(this)">${t.innerText}</li>`:`${a}<li class="${n}__item" value="${r}" onclick="selectOption(this)">${t.innerText}</li>`})),t.innerHTML=`${a}`}}document.addEventListener("DOMNodeInserted",(e=>{if("arc-widget-container"==e.target.id){e.target.childNodes[0].childNodes[0].contentWindow.document.querySelector("#launcher").style.background="#444"}})),window.onhashchange=function(e){if("popup"==e.oldURL.split("#").reverse()[0])return popupShow()},window.addEventListener("load",(()=>{"popup"==window.location.href.split("#").reverse()[0]&&history.replaceState("",document.title,window.location.pathname+window.location.search)})),window.addEventListener("load",(e=>{"/search"==location.pathname&&search()}));const selectors=document.querySelectorAll(".selector");async function watch(){loadPlayer();let e="https://kinopoiskapiunofficial.tech/api/v2.2/films/"+getUrlVars().id,t=await apiReq(e);document.title=t.nameRu+" — KinoFree",document.querySelector("#title").innerText=t.nameRu??t.nameOriginal??"-",document.querySelector("#year").innerText=t.year??"-",document.querySelector("#rating").innerText=t.ratingKinopoisk??t.rating??t.ratingImdb??"-",document.querySelector("#age").innerText=t.ratingAgeLimits.split("age")[1]+"+"??"-",document.querySelector("#desc").innerText=t.description??"-"}function watchSearch(e){if(!document.querySelector(".result")){let e=document.createElement("section");e.classList="result",e.id="result",e.innerHTML='\n      <ul class="result__list">\n      </ul>\n      <nav class="result__nav">\n      </nav>\n    ',document.querySelector(".container").appendChild(e)}let t=`watch?id=${getUrlVars().id}&type=${e}`,n=new URL(t,window.location.origin);window.history.replaceState({},"",n),search(),location.href="#result"}function loadPlayer(){let e=getUrlVars(),t=document.querySelector(".watch__player");switch(document.querySelector("select#playerUsed").value){case"0":default:t.src=`https://api1629919197.tobaco.ws/embed/kp/${e.id}`;break;case"1":t.src=`https://patriot.allohastream.com/?token=70f3e30270ec1a18376655a55e8646&kp=${e.id}`;break;case"2":t.src=`https://vcdn.kinoapi.club/sZfbdItt5jeX?kp_id=${e.id}`}}function getUrlVars(){for(var e,t=[],n=window.location.href.slice(window.location.href.indexOf("?")+1).split("&"),a=0;a<n.length;a++)e=n[a].split("="),t.push(e[0]),t[e[0]]=e[1];return t}async function apiReq(e){let t=await fetch(e,{method:"GET",headers:{"Content-Type":"application/json","X-API-KEY":"4b12f46d-638b-4bac-bf06-33865d3a3524"}});if(t.ok){let e=await t.json();return 0!=e.searchFilmsCountResult?e:(console.log("Ошибка запроса"),"Error")}return console.log("Ошибка сервера "+t.status),"Error"}selectors&&(window.innerWidth>768?selectors.forEach((e=>{let t=`\n          <span class="${e.classList}" onclick="selectToggle(this.parentNode)">${Array.from(e.querySelectorAll("option"))[e.value].innerText}</span>\n          <ul class="${e.classList[0]}__list">\n          </ul>\n      `,n=document.createElement("div");n.id=e.id,n.classList=`${e.classList[0]}__container`,n.innerHTML=t,e.parentNode.insertBefore(n,e),e.style.position="fixed",e.style.top="-100vh"})):selectors.forEach((e=>{e.addEventListener("change",(e=>{let t=document.querySelector(`select#${e.target.id}`);selectOnChange(t,t.value)}))}))),window.addEventListener("load",(e=>{"/watch"==location.pathname&&watch()}));