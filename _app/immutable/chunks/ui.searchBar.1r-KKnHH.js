import{s as j,j as k,q as I,k as y,b as A,d as g,r as V,x,f as d,t as D,i as J,g as m,y as Q,z as E,A as ee,h as te,B as se,l as le,m as ne,C as re,D as ae,E as oe}from"./scheduler.BjPIH0FZ.js";import{S as ie,i as ue,c as P,a as S,m as R,t as z,b as H,d as G}from"./index.CxIW9Pu1.js";import{L as fe,e as W,s as ce}from"./searchFilm.CKQ20VzS.js";import{a as pe,g as X}from"./entry.aaQkHcsM.js";import{p as he}from"./stores.CLCwFqj9.js";import{C as me}from"./cross.DxJXBDIk.js";import{A as _e}from"./arrow.BfNKM5ya.js";import{v as de}from"./ui.button.wOTSGOzO.js";function Y(a,n,e){const l=a.slice();return l[18]=n[e].title,l[19]=n[e].id,l}function Z(a){let n,e=W(a[0].list),l=[];for(let r=0;r<e.length;r+=1)l[r]=$(Y(a,e,r));return{c(){n=k("ul");for(let r=0;r<l.length;r+=1)l[r].c();this.h()},l(r){n=y(r,"UL",{class:!0});var s=A(n);for(let t=0;t<l.length;t+=1)l[t].l(s);s.forEach(g),this.h()},h(){d(n,"class","suggest svelte-f9d7u4")},m(r,s){J(r,n,s);for(let t=0;t<l.length;t+=1)l[t]&&l[t].m(n,null)},p(r,s){if(s&9){e=W(r[0].list);let t;for(t=0;t<e.length;t+=1){const _=Y(r,e,t);l[t]?l[t].p(_,s):(l[t]=$(_),l[t].c(),l[t].m(n,null))}for(;t<l.length;t+=1)l[t].d(1);l.length=e.length}},d(r){r&&g(n),se(l,r)}}}function $(a){let n,e=a[18]+"",l,r,s,t;function _(){return a[13](a[18])}return{c(){n=k("button"),l=le(e),r=I(),this.h()},l(o){n=y(o,"BUTTON",{class:!0});var u=A(n);l=ne(u,e),r=V(u),u.forEach(g),this.h()},h(){d(n,"class","svelte-f9d7u4")},m(o,u){J(o,n,u),m(n,l),m(n,r),s||(t=E(n,"pointerdown",re(_)),s=!0)},p(o,u){a=o,u&1&&e!==(e=a[18]+"")&&ae(l,e)},d(o){o&&g(n),s=!1,t()}}}function ge(a){let n,e,l,r,s,t,_,o,u,N,T=a[2]&&a[0].list.length&&a[3].trim().length>2,U,h,b,O="Найти",F,v,B,w,q,f;r=new fe({}),u=new me({props:{small:!0}});let c=T&&Z(a);return v=new _e({props:{circle:!0}}),{c(){n=k("div"),e=k("div"),l=k("div"),P(r.$$.fragment),s=I(),t=k("input"),_=I(),o=k("button"),P(u.$$.fragment),N=I(),c&&c.c(),U=I(),h=k("button"),b=k("p"),b.textContent=O,F=I(),P(v.$$.fragment),this.h()},l(i){n=y(i,"DIV",{class:!0});var p=A(n);e=y(p,"DIV",{class:!0});var C=A(e);l=y(C,"DIV",{class:!0});var K=A(l);S(r.$$.fragment,K),K.forEach(g),s=V(C),t=y(C,"INPUT",{type:!0,placeholder:!0,class:!0}),_=V(C),o=y(C,"BUTTON",{class:!0});var M=A(o);S(u.$$.fragment,M),M.forEach(g),N=V(C),c&&c.l(C),C.forEach(g),U=V(p),h=y(p,"BUTTON",{class:!0});var L=A(h);b=y(L,"P",{class:!0,"data-svelte-h":!0}),x(b)!=="svelte-173t95q"&&(b.textContent=O),F=V(L),S(v.$$.fragment,L),L.forEach(g),p.forEach(g),this.h()},h(){d(l,"class","loupe svelte-f9d7u4"),d(t,"type","text"),d(t,"placeholder","Фильм или сериал"),d(t,"class","svelte-f9d7u4"),d(o,"class","clear svelte-f9d7u4"),D(o,"canClear",a[3]),d(e,"class","input svelte-f9d7u4"),D(e,"inputFocus",a[2]),D(e,"inputValue",a[3].length&&!a[2]),d(b,"class","svelte-f9d7u4"),d(h,"class","search svelte-f9d7u4"),h.disabled=B=!(a[3].trim().length>0),d(n,"class","searchBar svelte-f9d7u4")},m(i,p){J(i,n,p),m(n,e),m(e,l),R(r,l,null),m(e,s),m(e,t),Q(t,a[3]),a[12](t),m(e,_),m(e,o),R(u,o,null),m(e,N),c&&c.m(e,null),m(n,U),m(n,h),m(h,b),m(h,F),R(v,h,null),w=!0,q||(f=[E(t,"focus",a[9]),E(t,"blur",a[10]),E(t,"keydown",a[8]),E(t,"keyup",a[7]),E(t,"input",a[11]),E(o,"click",a[5]),E(h,"pointerdown",a[14])],q=!0)},p(i,[p]){p&8&&t.value!==i[3]&&Q(t,i[3]),(!w||p&8)&&D(o,"canClear",i[3]),p&13&&(T=i[2]&&i[0].list.length&&i[3].trim().length>2),T?c?c.p(i,p):(c=Z(i),c.c(),c.m(e,null)):c&&(c.d(1),c=null),(!w||p&4)&&D(e,"inputFocus",i[2]),(!w||p&12)&&D(e,"inputValue",i[3].length&&!i[2]),(!w||p&8&&B!==(B=!(i[3].trim().length>0)))&&(h.disabled=B)},i(i){w||(z(r.$$.fragment,i),z(u.$$.fragment,i),z(v.$$.fragment,i),w=!0)},o(i){H(r.$$.fragment,i),H(u.$$.fragment,i),H(v.$$.fragment,i),w=!1},d(i){i&&g(n),G(r),a[12](null),G(u),c&&c.d(),G(v),q=!1,ee(f)}}}function be(a,n,e){let l;te(a,he,f=>e(17,l=f));let r,s={select:-1,list:[]},t,_=!1,o="";function u(f){e(2,_=f)}function N(){e(3,o=""),t.focus()}function T(){o.trim()&&X("./search?key="+encodeURIComponent(o))}let U=null;function h(f){f.key=="ArrowUp"||f.key=="ArrowDown"||o.trim().length<3||(U&&clearTimeout(U),e(0,s.select=-1,s),U=setTimeout(async()=>{let{films:c}=await ce(o);c?e(0,s.list=c.map(i=>({title:`${i.nameRu||i.nameEn} ${i.year||""}`,id:i.filmId})).slice(0,5),s):e(0,s.list=[],s),e(0,s.list[-1]={title:o},s)},400))}function b(f){f.key=="Enter"&&T(),f.key=="ArrowUp"&&s.list.length>0&&s.select>-1&&(e(0,s.select--,s),e(3,o=s.list[s.select].title)),f.key=="ArrowDown"&&s.list.length>0&&s.select+1<s.list.length&&(e(0,s.select++,s),e(3,o=s.list[s.select].title))}pe(()=>{r=Object.fromEntries(l.url.searchParams),r.key&&e(3,o=r.key)});const O=()=>u(!0),F=()=>u(!1);function v(){o=this.value,e(3,o)}function B(f){oe[f?"unshift":"push"](()=>{t=f,e(1,t)})}return[s,t,_,o,u,N,T,h,b,O,F,v,B,f=>{e(3,o=f),X(`/search?key=${f}`)},()=>{de(),T()}]}class Ae extends ie{constructor(n){super(),ue(this,n,be,ge,j,{})}}export{Ae as U};
