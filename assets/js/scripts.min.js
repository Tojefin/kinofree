//Полный файл есть на github https://github.com/Tojefin/kinofree
document.addEventListener("DOMContentLoaded",function(){var e=document.querySelector("#search"),t=document.querySelector("#search-title");$("#hidden-template").html();e&&e.addEventListener("click",function(){if($(".listBlock").remove(),"256px"==document.getElementById("form").style.height)var e="filters";else e="keyword";return search_parse(e)}),t&&t.addEventListener("keyup",function(e){if(e.preventDefault(),13===e.keyCode){if($(".listBlock").remove(),"256px"==document.getElementById("form").style.height)var t="filters";else t="keyword";return search_parse(t)}})});var title=document.querySelector("#search-title"),template=$("#hidden-template").html();async function search_parse(e,t){$("#search-list").empty();for(let e=0;e<=6;e++)$("#search-list").append(template);if($("#about").remove(),"keyword"===e){let e="https://kinopoiskapiunofficial.tech/api/v2.1/films/search-by-keyword?keyword="+title.value+"&page=1",t=await fetch(e,{method:"GET",headers:{"Content-Type":"application/json","X-API-KEY":"4b12f46d-638b-4bac-bf06-33865d3a3524"}});if(t.ok){let e=await t.json();console.log(e),$("#search-list").empty(),$(e.films).each(function(e,t){$("#search-list").append('<div class="listBlock"><img class="listImg" onclick="watch('+t.filmId+')" src="'+t.posterUrlPreview+'" width="20%" height="20%"><div style="display: grid;grid-template-columns: repeat(5, 1fr);grid-template-rows: repeat(5, 1fr);height: 0px;margin: 10px 10px;width: -webkit-fill-available;"><text class="listName"><a href="https://kinofree.skyedge.xyz/?watch='+t.filmId+'">'+t.nameRu+'</a></text><text class="listYear">'+t.year+'</text><text class="listRating">'+t.rating+'</text><text class="listDesc">'+t.description+"</text></div></div>")})}else alert("error",t.status)}if("filters"===e){window.scrollTo(0,0);let o="";$("input[type=checkbox]:checked").each(function(e){o=""==o?$(this).val():o+", "+$(this).val()});var i=document.getElementById("sorting").value,a=document.getElementById("kinotype").value,s=document.getElementById("years-slider").noUiSlider.get(!0),l=document.getElementById("rating-slider").noUiSlider.get(!0);void 0===t&&(t=1);let c="https://kinopoiskapiunofficial.tech/api/v2.1/films/search-by-filters?genre="+o+"&order="+i+"&type="+a+"&ratingFrom="+l[0]+"&ratingTo="+l[1]+"&yearFrom="+s[0]+"&yearTo="+s[1]+"&page="+t,p=await fetch(c,{method:"GET",headers:{"Content-Type":"application/json","X-API-KEY":"4b12f46d-638b-4bac-bf06-33865d3a3524"}});if(p.ok){let i=await p.json();console.log(i),$("#search-list").empty(),$(i.films).each(function(e,t){let i="";$(t.genres).each(function(e,t){i=""==i?t.genre:i+", "+t.genre}),$("#search-list").append('<div class="listBlock"><img class="listImg" onclick="watch('+t.filmId+')" src="'+t.posterUrlPreview+'" width="20%" height="20%"><div style="display: grid;grid-template-columns: repeat(5, 1fr);grid-template-rows: repeat(5, 1fr);height: 0px;margin: 10px 10px;width: -webkit-fill-available;"><text class="listName"><a href="https://kinofree.skyedge.xyz/?watch='+t.filmId+'">'+t.nameRu+'</a></text><text class="listYear">'+t.year+'</text><text class="listRating">'+t.rating+'</text><text class="listDesc">'+i+"</text></div></div>")});var r=t-1,n=t+1;1==t?$("#search-list").append('<input type="button" value="Страница '+n+'" onclick="search_parse(`'+e+'`, 2)" class="subbutton" style="display: flex;">'):$("#search-list").append('<div style="display: flex;"><input type="button" value="Страница '+r+'" onclick="search_parse(`'+e+"`, "+r+')" class="subbutton"> <input type="button" value="Страница '+n+'" onclick="search_parse(`'+e+"`, "+n+')" class="subbutton"></div>')}else alert("error",p.status)}if("populars"===e){window.scrollTo(0,0),void 0===t&&(t=1);let i="https://kinopoiskapiunofficial.tech/api/v2.2/films/top?type=TOP_100_POPULAR_FILMS&page="+t,a=await fetch(i,{method:"GET",headers:{"Content-Type":"application/json","X-API-KEY":"4b12f46d-638b-4bac-bf06-33865d3a3524"}});if(a.ok){let i=await a.json();console.log(i),$("#search-list").empty(),$(i.films).each(function(e,t){let i="";$(t.genres).each(function(e,t){i=""==i?t.genre:i+", "+t.genre}),$("#search-list").append('<div class="listBlock"><img class="listImg" onclick="watch('+t.filmId+')" src="'+t.posterUrlPreview+'" width="20%" height="20%"><div style="display: grid;grid-template-columns: repeat(5, 1fr);grid-template-rows: repeat(5, 1fr);height: 0px;margin: 10px 10px;width: -webkit-fill-available;"><text class="listName"><a href="https://kinofree.skyedge.xyz/?watch='+t.filmId+'">'+t.nameRu+'</a></text><text class="listYear">'+t.year+'</text><text class="listRating">'+t.rating+'</text><text class="listDesc">'+i+"</text></div></div>")});r=t-1,n=t+1;1==t?$("#search-list").append('<input type="button" value="Страница '+n+'" onclick="search_parse(`'+e+'`, 2)" class="subbutton" style="display: flex;">'):$("#search-list").append('<div style="display: flex;"><input type="button" value="Страница '+r+'" onclick="search_parse(`'+e+"`, "+r+')" class="subbutton"> <input type="button" value="Страница '+n+'" onclick="search_parse(`'+e+"`, "+n+')" class="subbutton"></div>')}else alert("error",a.status)}if("premiers"===e){var o=new Date,c=new Array;c[0]="JANUARY",c[1]="FEBRUARY",c[2]="MARCH",c[3]="APRIL",c[4]="MAY",c[5]="JUNE",c[6]="JULY",c[7]="AUGUST",c[8]="SEPTEMBER",c[9]="OCTOBER",c[10]="NOVEMBER",c[11]="DECEMBER";var p=c[o.getMonth()];window.scrollTo(0,0);let e="https://kinopoiskapiunofficial.tech/api/v2.2/films/premieres?year=2021&month="+p,t=await fetch(e,{method:"GET",headers:{"Content-Type":"application/json","X-API-KEY":"4b12f46d-638b-4bac-bf06-33865d3a3524"}});if(t.ok){let e=await t.json();console.log(e),$("#search-list").empty(),$(e.items).each(function(e,t){let i="";$(t.genres).each(function(e,t){i=""==i?t.genre:i+", "+t.genre}),$("#search-list").append('<div class="listBlock"><img class="listImg" onclick="watch('+t.filmId+')" src="'+t.posterUrlPreview+'" width="20%" height="20%"><div style="display: grid;grid-template-columns: repeat(5, 1fr);grid-template-rows: repeat(5, 1fr);height: 0px;margin: 10px 10px;width: -webkit-fill-available;"><text class="listName"><a href="https://kinofree.skyedge.xyz/?watch='+t.filmId+'">'+t.nameRu+'</a></text><text class="listYear">'+t.premiereRu+'</text><text class="listRating" style="color: #d018a0">'+t.duration+' минут</text><text class="listDesc">'+i+"</text></div></div>")})}else alert("error",t.status)}if("similars"===e){let e="https://kinopoiskapiunofficial.tech/api/v2.2/films/"+t+"/similars",i=await fetch(e,{method:"GET",headers:{"Content-Type":"application/json","X-API-KEY":"4b12f46d-638b-4bac-bf06-33865d3a3524"}});if(i.ok){let e=await i.json();console.log(e),$("#search-list").empty(),$(e.items).each(function(e,t){$("#search-list").append('<div class="listBlock"><img class="listImg" onclick="watch('+t.filmId+')" src="'+t.posterUrlPreview+'" width="20%" height="20%"><div style="display: grid;grid-template-columns: repeat(5, 1fr);grid-template-rows: repeat(5, 1fr);height: 0px;margin: 10px 10px;width: -webkit-fill-available;"><text class="listName"><a href="https://kinofree.skyedge.xyz/?watch='+t.filmId+'">'+t.nameRu+'</a></text><text class="listYear"></text><text class="listRating"></text><text class="listDesc"></text></div></div>')})}else alert("error",i.status)}if("sequels"===e){let e="https://kinopoiskapiunofficial.tech/api/v2.1/films/"+t+"/sequels_and_prequels",i=await fetch(e,{method:"GET",headers:{"Content-Type":"application/json","X-API-KEY":"4b12f46d-638b-4bac-bf06-33865d3a3524"}});if(i.ok){let e=await i.json();console.log(e),$("#search-list").empty(),$(e).each(function(e,t){$("#search-list").append('<div class="listBlock"><img class="listImg" onclick="watch('+t.filmId+')" src="'+t.posterUrlPreview+'" width="20%" height="20%"><div style="display: grid;grid-template-columns: repeat(5, 1fr);grid-template-rows: repeat(5, 1fr);height: 0px;margin: 10px 10px;width: -webkit-fill-available;"><text class="listName"><a href="https://kinofree.skyedge.xyz/?watch='+t.filmId+'">'+t.nameRu+'</a></text><text class="listYear"></text><text class="listRating"></text><text class="listDesc"></text></div></div>')})}else alert("error",i.status)}}function watch(e){var t=new URL("http://kinofree.skyedge.xyz/");t.searchParams.append("watch",e),window.location.href=t}function advancetform(){var e=document.getElementById("form"),t=document.querySelector(".advancet");"256px"==t.style.maxHeight?(e.style.height="56px",t.style.maxHeight="0px"):(e.style.height="256px",t.style.maxHeight="256px")}function linkcopy(){url=window.location.href,navigator.clipboard.writeText(url).then(function(){console.log("URL copy successful")},function(e){console.error("URL copy error",e)})}async function getInfo(e){let t="https://kinopoiskapiunofficial.tech/api/v2.2/films/"+e,i=await fetch(t,{method:"GET",headers:{"Content-Type":"application/json","X-API-KEY":"4b12f46d-638b-4bac-bf06-33865d3a3524"}});return i.ok?await i.json():alert("error",i.status)}window.onload=async function(){const e=new URLSearchParams(window.location.search);if(e.has("watch")){var t=e.get("watch");$("#hiddeonplayer").remove(),$("#player").append('<iframe src="https://apilordfilms-s.tobaco.ws/embed/kp/'+t+'" allow="autoplay *" width="500" height="300" allowfullscreen="" webkitallowfullscreen="" mozallowfullscreen="" oallowfullscreen="" msallowfullscreen="" style="border: hidden;border-radius: 10px;width: 90%;min-height: 50vh;box-shadow: 0px 0px 4px 0px rgb(80 80 80 / 70%);margin: 20px 0px;"></iframe>');let i=await getInfo(t);document.title=i.nameRu+" — KinoFree",$("#film-info").append('<div style="display:flex;"><input title="Скопировать ссылку" type="button" value="Ссылка &#128279;" class="subbutton" onclick="linkcopy()" style="margin: 0 5px 0 0;"> <input title="Найти фильмы похожие на этот" type="button" value="Похожее" class="subbutton" onclick="search_parse(`similars`, '+t+')" style="margin: 0 5px 0 0;"> <input title="Показать фильмы связанные с этим" type="button" value="Связанное" class="subbutton" onclick="search_parse(`sequels`, '+t+')" style="margin: 0 5px 0 0;"></div><text style="font-size: 24px;">'+i.nameRu+'</text><br><text style="margin-right: 10px;">'+i.year+'</text><text style="color: #aea">'+i.ratingKinopoisk+'</text><br><text style="bottom: 10px;position: relative;display: block;margin: 10px 0;" class="listDesc">'+i.description+"</text>")}var i=document.getElementById("years-slider");noUiSlider.create(i,{start:[1950,2022],tooltips:[!0,!0],connect:!0,range:{min:[1950,1],max:[2022,1]},format:{to:function(e){return"Год "+e},from:function(e){return e}},pips:{mode:"count",values:5,density:2}});var a=document.getElementById("rating-slider");noUiSlider.create(a,{start:[0,10],tooltips:[!0,!0],connect:!0,range:{min:[0,1],max:[10,1]},format:{to:function(e){return"Рейтинг "+e},from:function(e){return e}},pips:{mode:"count",values:11,density:5}})};
