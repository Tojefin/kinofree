//Полный файл есть на github https://github.com/Tojefin/kinofree
function addEvent(){var e=document.querySelector("#search-button"),t=document.querySelector("#search-title");e.addEventListener("click",function(){return search(getType())}),t.addEventListener("keyup",function(e){if(e.preventDefault(),13===e.keyCode)return search(getType())})}async function getInfo(e){let t="https://kinopoiskapiunofficial.tech/api/v2.2/films/"+e,a=await fetch(t,{method:"GET",headers:{"Content-Type":"application/json","X-API-KEY":"4b12f46d-638b-4bac-bf06-33865d3a3524"}});return a.ok?await a.json():alert("error",a.status)}function getType(){return document.querySelector(".search").classList.contains("search--open")?"filters":"keyword"}function getCard(e,t,a,o,i,l){let n="./index.html?watch="+e;return'<li class="card"><a href="'+n+'"><img class="card__img" src="'+t+'"></a><div class="card__info"><a href="'+n+'"><h3 class="card__title">'+a+'</h3></a><data class="card__year">'+o+'</data><p class="card__rating">'+i+'</p><p class="card__descript">'+l+'</p><small class="card__help">Поверните для описания</small></div></li>'}function getLoading(){return'<li class="card" id="loading"><img class="card__loading" src="assets/img/search-result.svg"></li>'}async function search(e,t){document.querySelector(".main-info").classList.add("hide"),document.querySelector(".result").classList.remove("hide");var a=document.querySelector("#search-title");$(".result_list").empty();for(let e=0;e<=6;e++)$(".result_list").append(getLoading());if("keyword"===e){let e="https://kinopoiskapiunofficial.tech/api/v2.1/films/search-by-keyword?keyword="+a.value+"&page=1",t=await fetch(e,{method:"GET",headers:{"Content-Type":"application/json","X-API-KEY":"4b12f46d-638b-4bac-bf06-33865d3a3524"}});if(t.ok){let e=await t.json();console.log(e),$(".result_list").empty(),$(e.films).each(function(e,t){$(".result_list").append(getCard(t.filmId,t.posterUrlPreview,t.nameRu,t.year,t.rating,t.description))})}else alert("Поиск не дал результата ",t.status)}if("filters"===e){window.scrollTo(0,0);let a="";$("input[type=checkbox]:checked").each(function(e){a=""==a?$(this).val():a+", "+$(this).val()});var o=document.getElementById("sorting").value,i=document.getElementById("film-type").value,l=document.getElementById("years-slider").noUiSlider.get(!0),n=document.getElementById("rating-slider").noUiSlider.get(!0);void 0===t&&(t=1);let c="https://kinopoiskapiunofficial.tech/api/v2.1/films/search-by-filters?genre="+a+"&order="+o+"&type="+i+"&ratingFrom="+n[0]+"&ratingTo="+n[1]+"&yearFrom="+l[0]+"&yearTo="+l[1]+"&page="+t,d=await fetch(c,{method:"GET",headers:{"Content-Type":"application/json","X-API-KEY":"4b12f46d-638b-4bac-bf06-33865d3a3524"}});if(d.ok){let a=await d.json();console.log(a),$(".result_list").empty(),$(a.films).each(function(e,t){let a="";$(t.genres).each(function(e,t){a=""==a?t.genre:a+", "+t.genre}),$(".result_list").append(getCard(t.filmId,t.posterUrlPreview,t.nameRu,t.year,t.rating,a))});var s=t-1,r=t+1;1==t?$(".result_list").append('<input type="button" value="Страница '+r+'" onclick="search(`'+e+'`, 2)" class="button">'):$(".result_list").append('<div style="display: flex;"><input type="button" value="Страница '+s+'" onclick="search(`'+e+"`, "+s+')" class="button"> <input type="button" value="Страница '+r+'" onclick="search(`'+e+"`, "+r+')" class="button"></div>')}else alert("error",d.status)}if("populars"===e){window.scrollTo(0,0),void 0===t&&(t=1);let a="https://kinopoiskapiunofficial.tech/api/v2.2/films/top?type=TOP_100_POPULAR_FILMS&page="+t,o=await fetch(a,{method:"GET",headers:{"Content-Type":"application/json","X-API-KEY":"4b12f46d-638b-4bac-bf06-33865d3a3524"}});if(o.ok){let a=await o.json();console.log(a),$(".result_list").empty(),$(a.films).each(function(e,t){let a="";$(t.genres).each(function(e,t){a=""==a?t.genre:a+", "+t.genre}),$(".result_list").append(getCard(t.filmId,t.posterUrlPreview,t.nameRu,t.year,t.rating,a))});s=t-1,r=t+1;1==t?$(".result_list").append('<input type="button" value="Страница '+r+'" onclick="search(`'+e+'`, 2)" class="button">'):$(".result_list").append('<div style="display: flex;"><input type="button" value="Страница '+s+'" onclick="search(`'+e+"`, "+s+')" class="button"> <input type="button" value="Страница '+r+'" onclick="search(`'+e+"`, "+r+')" class="button"></div>')}else alert("error",o.status)}if("premiers"===e){var c=new Date,d=new Array;d[0]="JANUARY",d[1]="FEBRUARY",d[2]="MARCH",d[3]="APRIL",d[4]="MAY",d[5]="JUNE",d[6]="JULY",d[7]="AUGUST",d[8]="SEPTEMBER",d[9]="OCTOBER",d[10]="NOVEMBER",d[11]="DECEMBER";var u=d[c.getMonth()];window.scrollTo(0,0);let e="https://kinopoiskapiunofficial.tech/api/v2.2/films/premieres?year=2021&month="+u,t=await fetch(e,{method:"GET",headers:{"Content-Type":"application/json","X-API-KEY":"4b12f46d-638b-4bac-bf06-33865d3a3524"}});if(t.ok){let e=await t.json();console.log(e),$(".result_list").empty(),$(e.items).each(function(e,t){let a="";$(t.genres).each(function(e,t){a=""==a?t.genre:a+", "+t.genre}),$(".result_list").append(getCard(t.filmId,t.posterUrlPreview,t.nameRu,t.premiereRu,"Длительность "+t.duration,a))})}else alert("error",t.status)}if("similars"===e){let e="https://kinopoiskapiunofficial.tech/api/v2.2/films/"+t+"/similars",a=await fetch(e,{method:"GET",headers:{"Content-Type":"application/json","X-API-KEY":"4b12f46d-638b-4bac-bf06-33865d3a3524"}});if(a.ok){let e=await a.json();console.log(e),$(".result_list").empty(),$(e.items).each(function(e,t){$(".result_list").append(getCard(t.filmId,t.posterUrlPreview,t.nameRu))})}else alert("error",a.status)}if("sequels"===e){let e="https://kinopoiskapiunofficial.tech/api/v2.1/films/"+t+"/sequels_and_prequels",a=await fetch(e,{method:"GET",headers:{"Content-Type":"application/json","X-API-KEY":"4b12f46d-638b-4bac-bf06-33865d3a3524"}});if(a.ok){let e=await a.json();console.log(e),$(".result_list").empty(),$(e).each(function(e,t){$(".result_list").append(getCard(t.filmId,t.posterUrlPreview,t.nameRu))})}else alert("error",a.status)}}function select(e,t){document.getElementById(e).value=t,document.getElementById(e).textContent=t,selectToggle(e+"-list")}function selectToggle(e){document.getElementById(e).classList.toggle("select__list--open")}function createSliders(){var e=document.getElementById("years-slider");noUiSlider.create(e,{start:[1950,2022],tooltips:[!0,!0],connect:!0,range:{min:[1950,1],max:[2022,1]},format:{to:function(e){return"Год "+e},from:function(e){return e}},pips:{mode:"count",values:5,density:2}});var t=document.getElementById("rating-slider");noUiSlider.create(t,{start:[0,10],tooltips:[!0,!0],connect:!0,range:{min:[0,1],max:[10,1]},format:{to:function(e){return"Рейтинг "+e},from:function(e){return e}},pips:{mode:"count",values:11,density:5}})}const content=document.querySelector(".content");function toggleFilters(){document.querySelector(".search").classList.toggle("search--open")}function toggleInfo(){document.querySelector(".main-info__general").classList.toggle("hide"),document.querySelector(".main-info__updates").classList.toggle("hide")}async function watch(e){let t=await getInfo(e);document.title=t.nameRu+" — KinoFree",console.log(),document.querySelector("#sim").setAttribute("onClick","javascript: search('similars', "+e+")"),document.querySelector("#linked").setAttribute("onClick","javascript: search('sequels', "+e+")"),$(".vert__info").append('<h3 class="view__title">'+t.nameRu+'</h3><data class="view__year">'+t.year+'</data><p class="view__rating">'+t.ratingKinopoisk+"</p>"),$(".view__info").append('<h3 class="view__title">'+t.nameRu+'</h3><data class="view__year">'+t.year+'</data><p class="view__rating">'+t.ratingKinopoisk+'</p><p class="view__descript">'+t.description+"</p>"),loadPlayer()}function loadPlayer(){var e=new URLSearchParams(window.location.search).get("watch");switch(document.querySelector("#player-select").value){case"Alpha":$("#player").html('<iframe sandbox="allow-forms allow-pointer-lock allow-same-origin allow-scripts allow-top-navigation" src="https://api1629919197.tobaco.ws/embed/kp/'+e+'" allow="autoplay *"></iframe>');break;case"Beta":$("#player").html('<iframe sandbox="allow-forms allow-pointer-lock allow-same-origin allow-scripts allow-top-navigation" src="https://patriot.allohastream.com/?token=70f3e30270ec1a18376655a55e8646&amp;kp='+e+'" allow="autoplay *"></iframe>');break;case"Gamma":$("#player").html('<iframe sandbox="allow-forms allow-pointer-lock allow-same-origin allow-scripts allow-top-navigation" src="https://vcdn.kinoapi.club/D89KbjxSAELP?kp_id='+e+'" allow="autoplay *"></iframe>');break;default:$("#player").html('<iframe sandbox="allow-forms allow-pointer-lock allow-same-origin allow-scripts allow-top-navigation" src="https://api1629919197.tobaco.ws/embed/kp/'+e+'" allow="autoplay *"></iframe>')}}function linkcopy(){url=window.location.href,navigator.clipboard.writeText(url).then(function(){console.log("URL copy successful")},function(e){console.error("URL copy error",e)})}window.onload=async function(){const e=new URLSearchParams(window.location.search);if(e.has("watch"))return document.querySelector(".header").classList.toggle("hide"),document.querySelector(".vert").classList.toggle("hide"),document.querySelector(".view").classList.toggle("hide"),void watch(e.get("watch"));createSliders(),addEvent(),document.querySelector(".header").classList.toggle("hide"),document.querySelector(".search").classList.toggle("hide"),document.querySelector(".menu--main").classList.toggle("hide"),document.querySelector(".main-info").classList.toggle("hide")};
