import{s as ee,a as ae,c as oe,b as v,d as c,f as u,i as V,g as d,n as S,j as k,q as T,l as N,k as b,r as q,m as G,a1 as ge,D as K,o as Pe,z as Ae,a3 as Ve,t as W,x as je,e as ke,h as Le}from"./scheduler.UmdBsXoH.js";import{S as te,i as se,c as X,a as Y,m as Z,t as C,g as fe,b as A,e as ce,d as x}from"./index.Vbt9v2Aa.js";import{p as Re}from"./stores.nNJZKXi5.js";import{g as Ue,a as Se}from"./entry.3nUynXgO.js";import{o as ue,w as Ce,e as be,u as Oe,a as Te,L as qe,s as Be}from"./searchFilm.q046qK5L.js";import"./ui.button.eDEFvkPg.js";import{A as Fe}from"./arrow.68QDVyr3.js";import{p as Ne}from"./index.3YLQEot0.js";function Ge(r){let e,s;return{c(){e=ae("svg"),s=ae("path"),this.h()},l(t){e=oe(t,"svg",{width:!0,height:!0,viewBox:!0,fill:!0,xmlns:!0});var l=v(e);s=oe(l,"path",{d:!0,stroke:!0,"stroke-width":!0,"stroke-linecap":!0,"stroke-linejoin":!0}),v(s).forEach(c),l.forEach(c),this.h()},h(){u(s,"d","M14 10V17M10 10V17M6 6V17.8C6 18.9201 6 19.4798 6.21799 19.9076C6.40973 20.2839 6.71547 20.5905 7.0918 20.7822C7.5192 21 8.07899 21 9.19691 21H14.8031C15.921 21 16.48 21 16.9074 20.7822C17.2837 20.5905 17.5905 20.2839 17.7822 19.9076C18 19.4802 18 18.921 18 17.8031V6M6 6H8M6 6H4M8 6H16M8 6C8 5.06812 8 4.60241 8.15224 4.23486C8.35523 3.74481 8.74432 3.35523 9.23437 3.15224C9.60192 3 10.0681 3 11 3H13C13.9319 3 14.3978 3 14.7654 3.15224C15.2554 3.35523 15.6447 3.74481 15.8477 4.23486C15.9999 4.6024 16 5.06812 16 6M16 6H18M18 6H20"),u(s,"stroke","white"),u(s,"stroke-width","2"),u(s,"stroke-linecap","round"),u(s,"stroke-linejoin","round"),u(e,"width","24"),u(e,"height","24"),u(e,"viewBox","0 0 24 24"),u(e,"fill","none"),u(e,"xmlns","http://www.w3.org/2000/svg")},m(t,l){V(t,e,l),d(e,s)},p:S,i:S,o:S,d(t){t&&c(e)}}}class Ke extends te{constructor(e){super(),se(this,e,null,Ge,ee,{})}}function ze(r){let e,s;return{c(){e=ae("svg"),s=ae("path"),this.h()},l(t){e=oe(t,"svg",{width:!0,height:!0,viewBox:!0,fill:!0,xmlns:!0});var l=v(e);s=oe(l,"path",{d:!0,stroke:!0,"stroke-width":!0,"stroke-linecap":!0,"stroke-linejoin":!0}),v(s).forEach(c),l.forEach(c),this.h()},h(){u(s,"d","M1.66699 14.6667H20.3337M1.66699 8.00004H20.3337M1.66699 1.33337H12.3337"),u(s,"stroke","white"),u(s,"stroke-width","2"),u(s,"stroke-linecap","round"),u(s,"stroke-linejoin","round"),u(e,"width","22"),u(e,"height","16"),u(e,"viewBox","0 0 22 16"),u(e,"fill","none"),u(e,"xmlns","http://www.w3.org/2000/svg")},m(t,l){V(t,e,l),d(e,s)},p:S,i:S,o:S,d(t){t&&c(e)}}}class $e extends te{constructor(e){super(),se(this,e,null,ze,ee,{})}}let Je="https://kinopoiskapiunofficial.tech/api/v2.2/films/";async function Qe(r){return r?await(await fetch(`${Je}${r}`,ue)).json():{}}let We="https://kinopoiskapiunofficial.tech/api/v2.2/films/collections";async function Xe(r=1){return await(await fetch(`${We}?page=${r}`,ue)).json()}let Ye="https://kinopoiskapiunofficial.tech/api/v2.2/films",Ze="https://kinopoiskapiunofficial.tech//api/v2.1/films";async function xe(r){if(r){let e=await fetch(`${Ye}/${r}/similars`,ue);e=await e.json();let s=await fetch(`${Ze}/${r}/sequels_and_prequels`,ue);s=await s.json();let t=[...s,...e.items];return t=t.filter((l,o,i)=>o===i.findIndex(n=>n.place===l.place&&n.filmId===l.filmId)),t}return[]}function et(r){let e;return{c(){e=k("span"),this.h()},l(s){e=b(s,"SPAN",{class:!0}),v(e).forEach(c),this.h()},h(){u(e,"class","svelte-4m7sxi")},m(s,t){V(s,e,t)},p:S,d(s){s&&c(e)}}}function tt(r){let e,s;return{c(){e=k("mark"),s=N(r[2]),this.h()},l(t){e=b(t,"MARK",{class:!0});var l=v(e);s=G(l,r[2]),l.forEach(c),this.h()},h(){u(e,"class","svelte-4m7sxi"),W(e,"okey",r[2]>3.9&&r[2]<7),W(e,"bad",r[2]<4)},m(t,l){V(t,e,l),d(e,s)},p(t,l){l&4&&K(s,t[2]),l&4&&W(e,"okey",t[2]>3.9&&t[2]<7),l&4&&W(e,"bad",t[2]<4)},d(t){t&&c(e)}}}function we(r){let e,s,t,l,o;return s=new Ke({}),{c(){e=k("button"),X(s.$$.fragment),this.h()},l(i){e=b(i,"BUTTON",{class:!0,title:!0});var n=v(e);Y(s.$$.fragment,n),n.forEach(c),this.h()},h(){u(e,"class","delete svelte-4m7sxi"),u(e,"title","Удалить")},m(i,n){V(i,e,n),Z(s,e,null),t=!0,l||(o=Ae(e,"click",Ve(r[3])),l=!0)},p:S,i(i){t||(C(s.$$.fragment,i),t=!0)},o(i){A(s.$$.fragment,i),t=!1},d(i){i&&c(e),x(s),l=!1,o()}}}function st(r){let e,s,t,l,o,i,n,h=(r[0].nameRu||r[0].nameEn||r[0].nameOriginal)+"",a,f,_,D,M=r[0].year+"",H,O,E,j=(r[0].description||"")+"",g,y,p,P,z,L,le,$,F,re,R;function he(m,I){return m[2]>0?tt:et}let ie=he(r),U=ie(r),w=r[1]&&we(r);return F=new Fe({}),{c(){e=k("a"),s=k("li"),t=k("img"),o=T(),i=k("div"),n=k("h3"),a=N(h),_=T(),D=k("time"),H=N(M),O=T(),E=k("p"),g=N(j),p=T(),P=k("div"),U.c(),z=T(),L=k("div"),w&&w.c(),le=T(),$=k("div"),X(F.$$.fragment),this.h()},l(m){e=b(m,"A",{href:!0,class:!0});var I=v(e);s=b(I,"LI",{class:!0});var J=v(s);t=b(J,"IMG",{src:!0,alt:!0,loading:!0,class:!0}),o=q(J),i=b(J,"DIV",{class:!0});var B=v(i);n=b(B,"H3",{title:!0,class:!0});var me=v(n);a=G(me,h),me.forEach(c),_=q(B),D=b(B,"TIME",{class:!0});var _e=v(D);H=G(_e,M),_e.forEach(c),O=q(B),E=b(B,"P",{title:!0,class:!0});var de=v(E);g=G(de,j),de.forEach(c),p=q(B),P=b(B,"DIV",{});var pe=v(P);U.l(pe),pe.forEach(c),B.forEach(c),z=q(J),L=b(J,"DIV",{class:!0});var ne=v(L);w&&w.l(ne),le=q(ne),$=b(ne,"DIV",{class:!0});var ve=v($);Y(F.$$.fragment,ve),ve.forEach(c),ne.forEach(c),J.forEach(c),I.forEach(c),this.h()},h(){ge(t.src,l=r[0].posterUrlPreview||r[0].posterUrl)||u(t,"src",l),u(t,"alt","Постер"),u(t,"loading","lazy"),t.inert=!0,u(t,"class","svelte-4m7sxi"),u(n,"title",f=r[0].nameRu||r[0].nameEn||r[0].nameOriginal),u(n,"class","svelte-4m7sxi"),u(D,"class","svelte-4m7sxi"),u(E,"title",y=r[0].description||""),u(E,"class","svelte-4m7sxi"),u(i,"class","text svelte-4m7sxi"),u($,"class","arrow svelte-4m7sxi"),u(L,"class","actions svelte-4m7sxi"),u(s,"class","svelte-4m7sxi"),u(e,"href",re=`/watch?id=${r[0].filmId||r[0].id||r[0].kinopoiskId}`),u(e,"class","svelte-4m7sxi")},m(m,I){V(m,e,I),d(e,s),d(s,t),d(s,o),d(s,i),d(i,n),d(n,a),d(i,_),d(i,D),d(D,H),d(i,O),d(i,E),d(E,g),d(i,p),d(i,P),U.m(P,null),d(s,z),d(s,L),w&&w.m(L,null),d(L,le),d(L,$),Z(F,$,null),R=!0},p(m,[I]){(!R||I&1&&!ge(t.src,l=m[0].posterUrlPreview||m[0].posterUrl))&&u(t,"src",l),(!R||I&1)&&h!==(h=(m[0].nameRu||m[0].nameEn||m[0].nameOriginal)+"")&&K(a,h),(!R||I&1&&f!==(f=m[0].nameRu||m[0].nameEn||m[0].nameOriginal))&&u(n,"title",f),(!R||I&1)&&M!==(M=m[0].year+"")&&K(H,M),(!R||I&1)&&j!==(j=(m[0].description||"")+"")&&K(g,j),(!R||I&1&&y!==(y=m[0].description||""))&&u(E,"title",y),ie===(ie=he(m))&&U?U.p(m,I):(U.d(1),U=ie(m),U&&(U.c(),U.m(P,null))),m[1]?w?(w.p(m,I),I&2&&C(w,1)):(w=we(m),w.c(),C(w,1),w.m(L,le)):w&&(fe(),A(w,1,1,()=>{w=null}),ce()),(!R||I&1&&re!==(re=`/watch?id=${m[0].filmId||m[0].id||m[0].kinopoiskId}`))&&u(e,"href",re)},i(m){R||(C(w),C(F.$$.fragment,m),R=!0)},o(m){A(w),A(F.$$.fragment,m),R=!1},d(m){m&&c(e),U.d(),w&&w.d(),x(F)}}}function ye(r,e,s,t,l,o,i){try{var n=r[o](i),h=n.value}catch(a){return void s(a)}n.done?e(h):Promise.resolve(h).then(t,l)}function lt(r){return function(){var e=this,s=arguments;return new Promise(function(t,l){var o=r.apply(e,s);function i(h){ye(o,t,l,i,n,"next",h)}function n(h){ye(o,t,l,i,n,"throw",h)}i(void 0)})}}function rt(r,e,s){let{canDelete:t=!1}=e,{film:l}=e;var o=l.rating||l.ratingKinopoisk;function i(){Ce.remove(l),Ue("")}return Pe(lt(function*(){l.description||(s(0,l=yield Qe(l.film_id||l.filmId||l.id||l.kinopoiskId)),s(2,o=l.rating||l.ratingKinopoisk))})),r.$$set=n=>{"canDelete"in n&&s(1,t=n.canDelete),"film"in n&&s(0,l=n.film)},[l,t,o,i]}class it extends te{constructor(e){super(),se(this,e,rt,st,ee,{canDelete:1,film:0})}}function Ee(r,e,s){const t=r.slice();return t[4]=e[s],t}function nt(r){let e,s,t,l,o,i,n,h=r[3].title+"",a,f,_,D=r[3].text+"",M,H;const O=[ft,ut],E=[];function j(g,y){return g[3].title=="Ничего не найдено"?0:1}return t=j(r),l=E[t]=O[t](r),{c(){e=k("div"),s=k("div"),l.c(),o=T(),i=k("div"),n=k("p"),a=N(h),f=T(),_=k("span"),M=N(D),this.h()},l(g){e=b(g,"DIV",{class:!0});var y=v(e);s=b(y,"DIV",{class:!0});var p=v(s);l.l(p),p.forEach(c),o=q(y),i=b(y,"DIV",{class:!0});var P=v(i);n=b(P,"P",{class:!0});var z=v(n);a=G(z,h),z.forEach(c),f=q(P),_=b(P,"SPAN",{class:!0});var L=v(_);M=G(L,D),L.forEach(c),P.forEach(c),y.forEach(c),this.h()},h(){u(s,"class","visual svelte-k8sv6m"),u(n,"class","svelte-k8sv6m"),u(_,"class","svelte-k8sv6m"),u(i,"class","text svelte-k8sv6m"),u(e,"class","nothing svelte-k8sv6m")},m(g,y){V(g,e,y),d(e,s),E[t].m(s,null),d(e,o),d(e,i),d(i,n),d(n,a),d(i,f),d(i,_),d(_,M),H=!0},p(g,y){let p=t;t=j(g),t!==p&&(fe(),A(E[p],1,1,()=>{E[p]=null}),ce(),l=E[t],l||(l=E[t]=O[t](g),l.c()),C(l,1),l.m(s,null)),(!H||y&8)&&h!==(h=g[3].title+"")&&K(a,h),(!H||y&8)&&D!==(D=g[3].text+"")&&K(M,D)},i(g){H||(C(l),H=!0)},o(g){A(l),H=!1},d(g){g&&c(e),E[t].d()}}}function at(r){let e,s,t=[],l=new Map,o,i=r[0]&&Ie(r),n=be(r[1]);const h=a=>a[4].filmId||a[4].id||a[4].kinopoiskId||a[4].film_id;for(let a=0;a<n.length;a+=1){let f=Ee(r,n,a),_=h(f);l.set(_,t[a]=De(_,f))}return{c(){i&&i.c(),e=T(),s=k("ul");for(let a=0;a<t.length;a+=1)t[a].c();this.h()},l(a){i&&i.l(a),e=q(a),s=b(a,"UL",{class:!0});var f=v(s);for(let _=0;_<t.length;_+=1)t[_].l(f);f.forEach(c),this.h()},h(){u(s,"class","svelte-k8sv6m")},m(a,f){i&&i.m(a,f),V(a,e,f),V(a,s,f);for(let _=0;_<t.length;_+=1)t[_]&&t[_].m(s,null);o=!0},p(a,f){a[0]?i?i.p(a,f):(i=Ie(a),i.c(),i.m(e.parentNode,e)):i&&(i.d(1),i=null),f&6&&(n=be(a[1]),fe(),t=Oe(t,f,h,1,a,n,l,s,Te,De,null,Ee),ce())},i(a){if(!o){for(let f=0;f<n.length;f+=1)C(t[f]);o=!0}},o(a){for(let f=0;f<t.length;f+=1)A(t[f]);o=!1},d(a){a&&(c(e),c(s)),i&&i.d(a);for(let f=0;f<t.length;f+=1)t[f].d()}}}function ot(r){let e,s='<div class="loader-spin svelte-k8sv6m"></div>';return{c(){e=k("div"),e.innerHTML=s,this.h()},l(t){e=b(t,"DIV",{class:!0,"data-svelte-h":!0}),je(e)!=="svelte-1en9h6o"&&(e.innerHTML=s),this.h()},h(){u(e,"class","loader svelte-k8sv6m")},m(t,l){V(t,e,l)},p:S,i:S,o:S,d(t){t&&c(e)}}}function ut(r){let e,s;return e=new $e({}),{c(){X(e.$$.fragment)},l(t){Y(e.$$.fragment,t)},m(t,l){Z(e,t,l),s=!0},i(t){s||(C(e.$$.fragment,t),s=!0)},o(t){A(e.$$.fragment,t),s=!1},d(t){x(e,t)}}}function ft(r){let e,s;return e=new qe({}),{c(){X(e.$$.fragment)},l(t){Y(e.$$.fragment,t)},m(t,l){Z(e,t,l),s=!0},i(t){s||(C(e.$$.fragment,t),s=!0)},o(t){A(e.$$.fragment,t),s=!1},d(t){x(e,t)}}}function Ie(r){let e,s;return{c(){e=k("h2"),s=N(r[0]),this.h()},l(t){e=b(t,"H2",{class:!0});var l=v(e);s=G(l,r[0]),l.forEach(c),this.h()},h(){u(e,"class","svelte-k8sv6m")},m(t,l){V(t,e,l),d(e,s)},p(t,l){l&1&&K(s,t[0])},d(t){t&&c(e)}}}function De(r,e){let s,t,l;return t=new it({props:{film:e[4],canDelete:e[2]}}),{key:r,first:null,c(){s=ke(),X(t.$$.fragment),this.h()},l(o){s=ke(),Y(t.$$.fragment,o),this.h()},h(){this.first=s},m(o,i){V(o,s,i),Z(t,o,i),l=!0},p(o,i){e=o;const n={};i&2&&(n.film=e[4]),i&4&&(n.canDelete=e[2]),t.$set(n)},i(o){l||(C(t.$$.fragment,o),l=!0)},o(o){A(t.$$.fragment,o),l=!1},d(o){o&&c(s),x(t,o)}}}function ct(r){let e,s,t,l,o;const i=[ot,at,nt],n=[];function h(a,f){return f&2&&(s=null),s==null&&(s=!Array.isArray(a[1])),s?0:a[1][0]?1:a[3].disable?-1:2}return~(t=h(r,-1))&&(l=n[t]=i[t](r)),{c(){e=k("section"),l&&l.c(),this.h()},l(a){e=b(a,"SECTION",{class:!0});var f=v(e);l&&l.l(f),f.forEach(c),this.h()},h(){u(e,"class","svelte-k8sv6m"),W(e,"disable",Array.isArray(r[1])&&!r[1].length&&r[3].disable)},m(a,f){V(a,e,f),~t&&n[t].m(e,null),o=!0},p(a,[f]){let _=t;t=h(a,f),t===_?~t&&n[t].p(a,f):(l&&(fe(),A(n[_],1,1,()=>{n[_]=null}),ce()),~t?(l=n[t],l?l.p(a,f):(l=n[t]=i[t](a),l.c()),C(l,1),l.m(e,null)):l=null),(!o||f&10)&&W(e,"disable",Array.isArray(a[1])&&!a[1].length&&a[3].disable)},i(a){o||(C(l),o=!0)},o(a){A(l),o=!1},d(a){a&&c(e),~t&&n[t].d()}}}function ht(r,e,s){let{lable:t=""}=e,{list:l}=e,{canDelete:o=!1}=e,{nothing:i={title:"Ничего не найдено",text:"",disable:!1}}=e;return r.$$set=n=>{"lable"in n&&s(0,t=n.lable),"list"in n&&s(1,l=n.list),"canDelete"in n&&s(2,o=n.canDelete),"nothing"in n&&s(3,i=n.nothing)},[t,l,o,i]}class mt extends te{constructor(e){super(),se(this,e,ht,ct,ee,{lable:0,list:1,canDelete:2,nothing:3})}}function _t(r){let e,s;return e=new mt({props:{list:r[1],lable:r[2],nothing:r[0],canDelete:r[3]}}),{c(){X(e.$$.fragment)},l(t){Y(e.$$.fragment,t)},m(t,l){Z(e,t,l),s=!0},p(t,[l]){const o={};l&2&&(o.list=t[1]),l&4&&(o.lable=t[2]),l&1&&(o.nothing=t[0]),l&8&&(o.canDelete=t[3]),e.$set(o)},i(t){s||(C(e.$$.fragment,t),s=!0)},o(t){A(e.$$.fragment,t),s=!1},d(t){x(e,t)}}}var Me=1;function He(r,e,s,t,l,o,i){try{var n=r[o](i),h=n.value}catch(a){return void s(a)}n.done?e(h):Promise.resolve(h).then(t,l)}function Q(r){return function(){var e=this,s=arguments;return new Promise(function(t,l){var o=r.apply(e,s);function i(h){He(o,t,l,i,n,"next",h)}function n(h){He(o,t,l,i,n,"throw",h)}i(void 0)})}}function dt(r,e,s){let t;Le(r,Re,p=>s(11,t=p));let{type:l="search"}=e;var o={disable:!0},i,n=[],h="",a=!1;function f(){return _.apply(this,arguments)}function _(){return _=Q(function*(){if(i=Object.fromEntries(t.url.searchParams),i.key){var p=yield Be(i.key,Me);s(1,n=p.films),s(2,h="Вот что нашли")}if(i.popular==""){var P=yield Xe(Me);s(1,n=P.items),s(2,h="Популярное")}s(0,o={title:"Ничего не найдено",text:"Попробуйте другой запрос для поиска",disable:!1})}),_.apply(this,arguments)}function D(){return M.apply(this,arguments)}function M(){return M=Q(function*(){s(1,n=Ce.get()),s(0,o={title:"История пуста",text:"Здесь будет список фильмов, которые вы смотрели на своём устройстве",disable:!1}),s(3,a=!0)}),M.apply(this,arguments)}function H(p){return O.apply(this,arguments)}function O(){return O=Q(function*(p){s(1,n=yield Ne.collection("lists").getFullList({sort:"-created",filter:'status = "'+p+'"'})),console.log(n),s(3,a=!1)}),O.apply(this,arguments)}function E(){return j.apply(this,arguments)}function j(){return j=Q(function*(){i=Object.fromEntries(t.url.searchParams);var p=yield xe(i.id);s(1,n=p),s(2,h="Похожие фильмы"),s(0,o={disable:!0})}),j.apply(this,arguments)}function g(p){return y.apply(this,arguments)}function y(){return y=Q(function*(p){switch(s(1,n=void 0),p){case"search":yield f();break;case"history":yield D();break;case"planned":yield H("planned"),s(0,o={title:"Список пуст",text:"",disable:!1});break;case"view":yield H("view"),s(0,o={title:"Список пуст",text:"",disable:!1});break;case"recomends":yield E();break}}),y.apply(this,arguments)}return Se(Q(function*(){g(l)})),r.$$set=p=>{"type"in p&&s(4,l=p.type)},r.$$.update=()=>{r.$$.dirty&16&&g(l)},[o,n,h,a,l]}class It extends te{constructor(e){super(),se(this,e,dt,_t,ee,{type:4})}}export{It as U,Qe as g};
