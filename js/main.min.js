"use strict";function createSliders(){var e=document.getElementById("years-slider");noUiSlider.create(e,{start:[1950,2022],tooltips:[!0,!0],connect:!0,range:{min:[1950,1],max:[2022,1]},format:{to:function(e){return"Год "+e},from:function(e){return e}},pips:{mode:"count",values:5,density:2}});var t=document.getElementById("rating-slider");noUiSlider.create(t,{start:[0,10],tooltips:[!0,!0],connect:!0,range:{min:[0,1],max:[10,1]},format:{to:function(e){return"Рейтинг "+e},from:function(e){return e}},pips:{mode:"count",values:11,density:5}})}try{createSliders()}catch(e){}function toggleFilters(){document.querySelector(".search__form").classList.toggle("search__form--open")}function popupShow(e){const t=document.querySelector(".popup-container");if(!t)return console.log("Контейнер не найден");t.addEventListener("click",(function(e){e.target==t&&popupShow()}));const n=document.querySelector("#popups");return n?e&&(t.innerHTML=n.content.querySelector("#"+e).outerHTML,window.location.hash="popup",t.classList.contains("popup-container--active"))?void 0:(t.classList.contains("popup-container--active")&&(t.innerHTML="",history.replaceState("",document.title,window.location.pathname+window.location.search)),t.classList.toggle("popup-container--active")):console.log("Шаблоны не найдены")}function preSearch(){let e;if(document.querySelector(".search__form").classList.contains("search__form--open")){let t=[];document.querySelectorAll("input[type=checkbox]:checked").forEach((e=>{t=""==t?e.value:t+","+e.value}));let n=document.querySelector("select#sorting").value,a=document.querySelector("select#film-type").value,c=document.getElementById("years-slider").noUiSlider.get(!0),o=document.getElementById("rating-slider").noUiSlider.get(!0);e="search?genr=".concat(t,"&sort=").concat(n,"&type=").concat(a,"&years=").concat(c,"&rating=").concat(o)}else{let t=document.querySelector("#search-title").value;e="search?keyword=".concat(t)}searchStart(e)}function searchStart(e){if("/search"==location.pathname){let t=new URL(e,window.location.origin);window.history.replaceState({},"",t),window.scrollTo(0,0),search()}else location.href=e}async function search(){var e,t,n;let a=document.querySelector(".result"),c=a.querySelector(".result__nav"),o=a.querySelector(".result__list");o.innerHTML='\n    <div class="card__loading"></div>\n    <div class="card__loading"></div>\n    <div class="card__loading"></div>\n    <div class="card__loading"></div>\n  ';let r=getUrlVars();switch(r.page||(r.page=1),r[0]){case"keyword":var l="https://kinopoiskapiunofficial.tech/api/v2.2/films?keyword="+r.keyword+"&page="+r.page;document.querySelector("#search-title").value=decodeURI(r.keyword);break;case"genr":r.genr=r.genr.split(","),r.rating=r.rating.split(","),r.years=r.years.split(",");l="https://kinopoiskapiunofficial.tech/api/v2.2/films?genres="+r.genr+"&order="+r.sort+"&type="+r.type+"&ratingFrom="+r.rating[0]+"&ratingTo="+r.rating[1]+"&yearFrom="+r.years[0]+"&yearTo="+r.years[1]+"&page="+r.page;break;case"popular":l="https://kinopoiskapiunofficial.tech/api/v2.2/films/top?type=TOP_100_POPULAR_FILMS&page="+r.page;break;case"premiers":let e=new Date,t=["JANUARY","FEBRUARY","MARCH","APRIL","MAY","JUNE","JULY","AUGUST","SEPTEMBER","OCTOBER","NOVEMBER","DECEMBER"][e.getMonth()];l="https://kinopoiskapiunofficial.tech/api/v2.2/films/premieres?year=20"+e.getYear().toString().substring(1)+"&month="+t;break;case"id":if("similars"==r.type)var i="2";else i="1";l="https://kinopoiskapiunofficial.tech/api/v2.".concat(i,"/films/").concat(r.id,"/").concat(r.type)}let s=await apiReq(l);if(o.innerHTML="","Error"==s||""==s)return o.innerHTML+='\n      <div>\n        <h2 class="card__title">Ничего не найдено</h2>\n        <p class="card__other">Попробуйте изменить запрос</p>\n      </div>\n    ',void(c.innerHTML="");(null!==(e=null!==(t=s.films)&&void 0!==t?t:s.items)&&void 0!==e?e:s).forEach((e=>{var t,n,a,c,r,l,i,s,u,d,p;if(e.genres){var g="";e.genres.forEach((e=>{g="".concat(g).concat(e.genre," ")}))}if(e.relationType)if("SEQUEL"==e.relationType)var h="Продолжение";else if("PREQUEL"==e.relationType)h="Предыстория";var v=null!==(t=e.kinopoiskId)&&void 0!==t?t:e.filmId,m=null!==(n=null!==(a=e.nameRu)&&void 0!==a?a:e.nameOriginal)&&void 0!==n?n:"-",y=null!==(c=null!==(r=e.premiereRu)&&void 0!==r?r:e.year)&&void 0!==c?c:"-",f=null!==(l=null!==(i=null!==(s=e.ratingKinopoisk)&&void 0!==s?s:e.rating)&&void 0!==i?i:e.ratingImdb)&&void 0!==l?l:"-",w=null!==(u=null!==(d=null!==(p=e.description)&&void 0!==p?p:g)&&void 0!==d?d:h)&&void 0!==u?u:"-",S='\n      <a href="/watch?id='.concat(v,'"><h2 class="card__title" title="').concat(m,'">').concat(m,"</h2></a>\n    "),_=(y='\n      <small class="card__year">'.concat(y,"</small>\n    "),f='\n      <small class="card__rating">'.concat(f,"</small>\n    "),'\n      <p class="card__desc">'.concat(w,"</p>\n    "));o.innerHTML+='\n      <div class="card">\n        <a href="/watch?id='.concat(v,'"><img class="card__img" loading="lazy" src="').concat(e.posterUrlPreview,'"></a>\n        <div class="card__info">\n          ').concat(S,"\n          ").concat(y,"\n          ").concat(f,"\n          ").concat(_,"\n        </div>\n      </div>\n    ")}));let u=null!==(n=s.totalPages)&&void 0!==n?n:s.pagesCount;if(u){var d=+r.page-1,p=+r.page+1;let e,t='<input class="button result__button" type="button" value="<" onclick="searchStart(\'search'.concat(location.search.replace("&page="+r.page,"&page="+d),"')\">");e=getUrlVars().page?'<input class="button result__button" type="button" value=">" onclick="searchStart(\'search'.concat(location.search.replace("&page="+r.page,"&page="+p),"')\">"):'<input class="button result__button" type="button" value=">" onclick="searchStart(\'search'.concat(location.search,"&page=2')\">"),1==r.page?c.innerHTML="<p>Страница ".concat(r.page,"</p> ").concat(e):u!=r.page?c.innerHTML="".concat(t," <p>Страница ").concat(r.page,"</p> ").concat(e):c.innerHTML="".concat(t," <p>Страница ").concat(r.page,"</p>")}}function selectOnChange(e,t,n){if(t!=n){if(e.querySelectorAll("option")[n])var a=e.querySelectorAll("option")[n].value;else a=null;let c=e.value;const o=new CustomEvent("selectorChange",{bubbles:!0,detail:{value:"".concat(c),oldvalue:"".concat(a),valueId:"".concat(t),oldvalueId:"".concat(n)}});e.dispatchEvent(o)}}function selectOption(e){let t=e.parentNode.parentNode;selectChangeValue(document.querySelector("select#".concat(t.id)),e.value),selectToggle(t)}function selectChangeValue(e,t,n){let a=document.querySelector("div#".concat(e.id));if(a){var c=a.value;a.querySelector("span").innerText=a.querySelectorAll("li")[t].innerText,a.value=t}e.value=e.querySelectorAll("option")[t].value,n||selectOnChange(e,t,c)}function selectToggle(e){let t=e.querySelector("ul"),n=e.querySelector("span").classList[0];if(t.classList.toggle("".concat(t.classList[0],"--open")),t.classList.contains("".concat(t.classList[0],"--open"))){let a="";document.querySelector("select#".concat(e.id)).querySelectorAll("option").forEach(((t,c)=>{if(t.value==e.value)var o="".concat(n,"__item ").concat(n,"__item--active");else o="".concat(n,"__item");a="".concat(a,'<li class="').concat(o,'" value="').concat(c,'" onclick="selectOption(this)">').concat(t.innerText,"</li>")})),t.innerHTML="".concat(a),e.focus(),e.addEventListener("focusout",(()=>{t.classList.remove("".concat(t.classList[0],"--open")),t.innerHTML=""}),{once:!0})}else t.innerHTML=""}document.addEventListener("DOMNodeInserted",(e=>{if("arc-widget-container"==e.target.id){e.target.childNodes[0].childNodes[0].contentWindow.document.querySelector("#launcher").style.background="#444"}})),window.onhashchange=function(e){if("popup"==e.oldURL.split("#").reverse()[0])return popupShow()},window.addEventListener("load",(()=>{"popup"==window.location.href.split("#").reverse()[0]&&history.replaceState("",document.title,window.location.pathname+window.location.search)})),window.addEventListener("load",(e=>{"/search"==location.pathname&&search()}));const selectors=document.querySelectorAll("select");async function watch(){var e,t,n,a,c,o,r,l;loadPlayer();let i="https://kinopoiskapiunofficial.tech/api/v2.2/films/"+getUrlVars().id,s=await apiReq(i);document.title=s.nameRu+" — KinoFree",document.querySelector("#title").innerText=null!==(e=null!==(t=s.nameRu)&&void 0!==t?t:s.nameOriginal)&&void 0!==e?e:"-",document.querySelector("#year").innerText=null!==(n=s.year)&&void 0!==n?n:"-",document.querySelector("#rating").innerText=null!==(a=null!==(c=null!==(o=s.ratingKinopoisk)&&void 0!==o?o:s.rating)&&void 0!==c?c:s.ratingImdb)&&void 0!==a?a:"-",document.querySelector("#age").innerText=null!==(r=s.ratingAgeLimits.split("age")[1]+"+")&&void 0!==r?r:"-",document.querySelector("#desc").innerText=null!==(l=s.description)&&void 0!==l?l:"-";let u=document.querySelector("select#filmState");u.addEventListener("selectorChange",(()=>{selectChangeValue(u,0,!0)}));let d=document.querySelector("select#playerUsed");d.addEventListener("selectorChange",(()=>{loadPlayer(d.value)}))}function watchSearch(e){if(!document.querySelector(".result")){let e=document.createElement("section");e.classList="result",e.id="result",e.innerHTML='\n      <ul class="result__list">\n      </ul>\n      <nav class="result__nav">\n      </nav>\n    ',document.querySelector(".container").appendChild(e)}let t=getUrlVars(),n="watch?id=".concat(t.id,"&type=").concat(e),a=new URL(n,window.location.origin);window.history.replaceState({},"",a),search(),location.href="#result"}function loadPlayer(){let e=getUrlVars(),t=document.querySelector(".watch__player");switch(document.querySelector("select#playerUsed").value){case"0":default:t.src="https://api1629919197.tobaco.ws/embed/kp/".concat(e.id);break;case"1":t.src="https://patriot.allohastream.com/?token=70f3e30270ec1a18376655a55e8646&kp=".concat(e.id);break;case"2":t.src="https://vcdn.kinoapi.club/sZfbdItt5jeX?kp_id=".concat(e.id)}}function getUrlVars(){for(var e,t=[],n=window.location.href.slice(window.location.href.indexOf("?")+1).split("&"),a=0;a<n.length;a++)e=n[a].split("="),t.push(e[0]),t[e[0]]=e[1];return t}async function apiReq(e){let t=await fetch(e,{method:"GET",headers:{"Content-Type":"application/json","X-API-KEY":"4b12f46d-638b-4bac-bf06-33865d3a3524"}});if(t.ok){let e=await t.json();return 0!=e.searchFilmsCountResult?e:(console.log("Ошибка запроса"),"Error")}return console.log("Ошибка сервера "+t.status),"Error"}selectors&&(window.innerWidth>768?selectors.forEach((e=>{let t='\n        <span class="'.concat(e.classList,'" onclick="selectToggle(this.parentNode)">').concat(Array.from(e.querySelectorAll("option"))[0].innerText,'</span>\n        <ul class="').concat(e.classList[0],'__list"></ul>\n      '),n=document.createElement("div");n.id=e.id,n.value=0,n.tabIndex="-1",n.classList="".concat(e.classList[0],"__container"),n.innerHTML=t,e.parentNode.insertBefore(n,e),e.style.cssText="\n        position: fixed;\n        top: -100vh;\n      "})):selectors.forEach((e=>{e.addEventListener("change",(e=>{let t=document.querySelector("select#".concat(e.target.id));selectOnChange(t,t.value,null)}))}))),window.addEventListener("load",(e=>{"/watch"==location.pathname&&watch()}));