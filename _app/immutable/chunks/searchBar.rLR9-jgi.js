import{s as Z,r as x,c as ee,b as te}from"./scheduler.hW0JTbzp.js";import{S as se,i as ne,e as k,k as L,s as B,c as y,a as I,l as P,d as g,f as D,m as le,n as d,o as V,g as z,h as m,p as R,q as K,r as E,u as $,v as H,w as j,x as re,t as ae,b as oe,y as ie,j as ue}from"./index.vbNZMW90.js";import{o as fe,L as ce,e as M}from"./_options.ppq8KazM.js";import{a as pe,g as Q}from"./entry.P8BNo9Q_.js";import{C as he,A as me,v as _e}from"./watchPlayer.svelte_svelte_type_style_lang.LwP3CBpu.js";import{p as de}from"./stores.EF20BVfc.js";let ge="https://kinopoiskapiunofficial.tech/api/v2.1/films/search-by-keyword";async function be(n,l=1){return n?await(await fetch(`${ge}?keyword=${n}&page=${l}`,fe)).json():[]}function W(n,l,e){const r=n.slice();return r[18]=l[e].title,r[19]=l[e].id,r}function X(n){let l,e=M(n[0].list),r=[];for(let a=0;a<e.length;a+=1)r[a]=Y(W(n,e,a));return{c(){l=k("ul");for(let a=0;a<r.length;a+=1)r[a].c();this.h()},l(a){l=y(a,"UL",{class:!0});var s=I(l);for(let t=0;t<r.length;t+=1)r[t].l(s);s.forEach(g),this.h()},h(){d(l,"class","suggest svelte-f9d7u4")},m(a,s){z(a,l,s);for(let t=0;t<r.length;t+=1)r[t]&&r[t].m(l,null)},p(a,s){if(s&9){e=M(a[0].list);let t;for(t=0;t<e.length;t+=1){const _=W(a,e,t);r[t]?r[t].p(_,s):(r[t]=Y(_),r[t].c(),r[t].m(l,null))}for(;t<r.length;t+=1)r[t].d(1);r.length=e.length}},d(a){a&&g(l),re(r,a)}}}function Y(n){let l,e=n[18]+"",r,a,s,t;function _(){return n[13](n[18])}return{c(){l=k("button"),r=ae(e),a=B(),this.h()},l(o){l=y(o,"BUTTON",{class:!0});var u=I(l);r=oe(u,e),a=D(u),u.forEach(g),this.h()},h(){d(l,"class","svelte-f9d7u4")},m(o,u){z(o,l,u),m(l,r),m(l,a),s||(t=E(l,"pointerdown",ie(_)),s=!0)},p(o,u){n=o,u&1&&e!==(e=n[18]+"")&&ue(r,e)},d(o){o&&g(l),s=!1,t()}}}function ve(n){let l,e,r,a,s,t,_,o,u,N,T=n[2]&&n[0].list.length&&n[3].trim().length>2,U,h,b,F="Найти",S,v,A,w,O,f;a=new ce({}),u=new he({props:{small:!0}});let c=T&&X(n);return v=new me({props:{circle:!0}}),{c(){l=k("div"),e=k("div"),r=k("div"),L(a.$$.fragment),s=B(),t=k("input"),_=B(),o=k("button"),L(u.$$.fragment),N=B(),c&&c.c(),U=B(),h=k("button"),b=k("p"),b.textContent=F,S=B(),L(v.$$.fragment),this.h()},l(i){l=y(i,"DIV",{class:!0});var p=I(l);e=y(p,"DIV",{class:!0});var C=I(e);r=y(C,"DIV",{class:!0});var G=I(r);P(a.$$.fragment,G),G.forEach(g),s=D(C),t=y(C,"INPUT",{type:!0,placeholder:!0,class:!0}),_=D(C),o=y(C,"BUTTON",{class:!0});var J=I(o);P(u.$$.fragment,J),J.forEach(g),N=D(C),c&&c.l(C),C.forEach(g),U=D(p),h=y(p,"BUTTON",{class:!0});var q=I(h);b=y(q,"P",{class:!0,"data-svelte-h":!0}),le(b)!=="svelte-173t95q"&&(b.textContent=F),S=D(q),P(v.$$.fragment,q),q.forEach(g),p.forEach(g),this.h()},h(){d(r,"class","loupe svelte-f9d7u4"),d(t,"type","text"),d(t,"placeholder","Фильм или сериал"),d(t,"class","svelte-f9d7u4"),d(o,"class","clear svelte-f9d7u4"),V(o,"canClear",n[3]),d(e,"class","input svelte-f9d7u4"),V(e,"inputFocus",n[2]),V(e,"inputValue",n[3].length&&!n[2]),d(b,"class","svelte-f9d7u4"),d(h,"class","search svelte-f9d7u4"),h.disabled=A=!(n[3].trim().length>0),d(l,"class","searchBar svelte-f9d7u4")},m(i,p){z(i,l,p),m(l,e),m(e,r),R(a,r,null),m(e,s),m(e,t),K(t,n[3]),n[12](t),m(e,_),m(e,o),R(u,o,null),m(e,N),c&&c.m(e,null),m(l,U),m(l,h),m(h,b),m(h,S),R(v,h,null),w=!0,O||(f=[E(t,"focus",n[9]),E(t,"blur",n[10]),E(t,"keydown",n[8]),E(t,"keyup",n[7]),E(t,"input",n[11]),E(o,"click",n[5]),E(h,"pointerdown",n[14])],O=!0)},p(i,[p]){p&8&&t.value!==i[3]&&K(t,i[3]),(!w||p&8)&&V(o,"canClear",i[3]),p&13&&(T=i[2]&&i[0].list.length&&i[3].trim().length>2),T?c?c.p(i,p):(c=X(i),c.c(),c.m(e,null)):c&&(c.d(1),c=null),(!w||p&4)&&V(e,"inputFocus",i[2]),(!w||p&12)&&V(e,"inputValue",i[3].length&&!i[2]),(!w||p&8&&A!==(A=!(i[3].trim().length>0)))&&(h.disabled=A)},i(i){w||($(a.$$.fragment,i),$(u.$$.fragment,i),$(v.$$.fragment,i),w=!0)},o(i){H(a.$$.fragment,i),H(u.$$.fragment,i),H(v.$$.fragment,i),w=!1},d(i){i&&g(l),j(a),n[12](null),j(u),c&&c.d(),j(v),O=!1,x(f)}}}function we(n,l,e){let r;ee(n,de,f=>e(17,r=f));let a,s={select:-1,list:[]},t,_=!1,o="";function u(f){e(2,_=f)}function N(){e(3,o=""),t.focus()}function T(){o.trim()&&Q("./search?key="+encodeURIComponent(o))}let U=null;function h(f){f.key=="ArrowUp"||f.key=="ArrowDown"||o.trim().length<3||(U&&clearTimeout(U),e(0,s.select=-1,s),U=setTimeout(async()=>{let{films:c}=await be(o);c?e(0,s.list=c.map(i=>({title:`${i.nameRu||i.nameEn} ${i.year||""}`,id:i.filmId})).slice(0,5),s):e(0,s.list=[],s),e(0,s.list[-1]={title:o},s)},400))}function b(f){f.key=="Enter"&&T(),f.key=="ArrowUp"&&s.list.length>0&&s.select>-1&&(e(0,s.select--,s),e(3,o=s.list[s.select].title)),f.key=="ArrowDown"&&s.list.length>0&&s.select+1<s.list.length&&(e(0,s.select++,s),e(3,o=s.list[s.select].title))}pe(()=>{a=Object.fromEntries(r.url.searchParams),a.key&&e(3,o=a.key)});const F=()=>u(!0),S=()=>u(!1);function v(){o=this.value,e(3,o)}function A(f){te[f?"unshift":"push"](()=>{t=f,e(1,t)})}return[s,t,_,o,u,N,T,h,b,F,S,v,A,f=>{e(3,o=f),Q(`/search?key=${f}`)},()=>{_e(),T()}]}class Ie extends se{constructor(l){super(),ne(this,l,we,ve,Z,{})}}export{Ie as S,be as s};
