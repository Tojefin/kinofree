<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
	<meta http-equiv="X-UA-Compatible" content="ie=edge">
	<link rel="shortcut icon" href="assets/img/favicon.ico" type="image/x-icon">
	<link rel="stylesheet" href="assets/css/style.css">
	<link rel="preconnect" href="https://fonts.googleapis.com">
	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;700&display=swap" rel="stylesheet">
	<title>KinoFree</title>
</head>
<body>
<div class="main">
	<div class="container">
		<a href="/"><h1 class="title">KinoFree</h1></a>
		<text class="subtitle">Смотрите кино бесплатно</text>

		<div class="form" id="search-form">
			<svg class="u-svg-content" viewBox="0 0 512 512" x="0px" y="0px" id="svg-d182" style="width: 33px;height: 32px;margin-left: 10px;fill: #777;">
				<path d="M505.749,475.587l-145.6-145.6c28.203-34.837,45.184-79.104,45.184-127.317c0-111.744-90.923-202.667-202.667-202.667    S0,90.925,0,202.669s90.923,202.667,202.667,202.667c48.213,0,92.48-16.981,127.317-45.184l145.6,145.6    c4.16,4.16,9.621,6.251,15.083,6.251s10.923-2.091,15.083-6.251C514.091,497.411,514.091,483.928,505.749,475.587z     M202.667,362.669c-88.235,0-160-71.765-160-160s71.765-160,160-160s160,71.765,160,160S290.901,362.669,202.667,362.669z"/>
			</svg>
			<input type="text" placeholder="Название фильма" id="search-title" name="title" class="search">
			<input type="button" value="Найти" id="search" class="button">
		</div>

		<div id="player"></div>
		<div id="film-info" style="text-align: left;margin: 0 8%;position: relative;"></div>
		<div id="search-list" class="search-list"></div>
	</div>

	<!--<div class="menu">
		<a href="https://www.donationalerts.com/r/tojefin" target="_blank"><text style="color: #888;">Donate</text></a>
	</div>-->
</div>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
<script id="hidden-template" type="text/x-custom-template">
	<div class="listBlock" id="loading">
	<svg
	  role="img"
	  width="100%"
	  height="250"
	  aria-labelledby="loading-aria"
	  viewBox="0 0 800 250"
	  preserveAspectRatio="none"
	>
	  <title id="loading-aria">Loading...</title>
	  <rect
	    x="0"
	    y="0"
	    width="100%"
	    height="100%"
	    clip-path="url(#clip-path)"
	    style='fill: url("#fill");'
	  ></rect>
	  <defs>
	    <clipPath id="clip-path">
	        <rect x="12" y="9" rx="3" ry="3" width="130" height="93%" />
	        <rect x="170" y="77" rx="3" ry="3" width="76%" height="163" />
	        <rect x="170" y="45" rx="3" ry="3" width="69" height="18" />
	        <rect x="260" y="45" rx="3" ry="3" width="21" height="18" />
	        <rect x="170" y="10" rx="3" ry="3" width="378" height="22" />
	    </clipPath>
	    <linearGradient id="fill">
	      <stop
	        offset="0.599964"
	        stop-color="#111"
	        stop-opacity="1"
	      >
	        <animate
	          attributeName="offset"
	          values="-2; -2; 1"
	          keyTimes="0; 0.25; 1"
	          dur="1s"
	          repeatCount="indefinite"
	        ></animate>
	      </stop>
	      <stop
	        offset="1.59996"
	        stop-color="#222"
	        stop-opacity="1"
	      >
	        <animate
	          attributeName="offset"
	          values="-1; -1; 2"
	          keyTimes="0; 0.25; 1"
	          dur="1s"
	          repeatCount="indefinite"
	        ></animate>
	      </stop>
	      <stop
	        offset="2.59996"
	        stop-color="#111"
	        stop-opacity="1"
	      >
	        <animate
	          attributeName="offset"
	          values="0; 0; 3"
	          keyTimes="0; 0.25; 1"
	          dur="1s"
	          repeatCount="indefinite"
	        ></animate>
	      </stop>
	    </linearGradient>
	  </defs>
	</svg>
	</div>
</script>
<script src='https://arc.io/arc-sw-core.js'></script>
<script>
    document.addEventListener('DOMContentLoaded', function () {

        var search = document.querySelector('#search');
        var title = document.querySelector('#search-title');

				var template = $('#hidden-template').html();

				if (search) {
            search.addEventListener('click', function () {
							$(".listBlock").remove();
              return search_parse();
							console.log(title);
            });
        }

        if (title) {
            title.addEventListener('keyup', function (event) {
                event.preventDefault();
                if (event.keyCode === 13) {
									$(".listBlock").remove();
                  return search_parse();
									console.log(title);
                }
            });
        }

			 	async function search_parse() {
					for (let i = 0; i <= 6; i++) {
						$('#search-list').append(template);
					}

					let url = ('https://kinopoiskapiunofficial.tech/api/v2.1/films/search-by-keyword?keyword=' + title.value + '&page=1');
					let response = await fetch(url , {
						method: 'GET',
						headers: {
							"Content-Type": "application/json",
							"X-API-KEY": "4b12f46d-638b-4bac-bf06-33865d3a3524",
						},
					});
					if (response.ok) {
					  let data = await response.json();
					  console.log(data);
						$(".listBlock").remove();
						$(data.films).each(function(index, item) {
						  $('#search-list').append('<div class="listBlock"><img class="listImg" onclick="watch('+item.filmId+')" src="'+ item.posterUrl +'" width="20%" height="20%"><div style="display: grid;grid-template-columns: repeat(3, 1fr);gap: 2%;"><text class="listName" onclick="watch('+item.filmId+')">' + item.nameRu + '</text><text class="listYear">' + item.year + '</text><text class="listRating">' + item.rating + '</text><text class="listDesc">' + item.description + '</text></div></div>');
						});
					} else {
					  alert('error', response.status);
					}
				}
    });
</script>
<script>
	function watch(id) {
		var url = new URL("http://kinofree.skyedge.xyz/");
		url.searchParams.append('watch', id);
		window.location.href = url
	}

	function linkcopy() {
		url = window.location.href
		navigator.clipboard.writeText(url).then(function() {
	    console.log('URL copy successful');
	  }, function(err) {
	    console.error('URL copy error', err);
	  });
	}

	window.onload = function() {
		const urlParams = new URLSearchParams(window.location.search);
		if (urlParams.has('watch')){
			var id = urlParams.get('watch')
			$(".search-list").remove();
			$("#search-form").remove();
			$('#player').append('<iframe src="https://apilordfilms-s.tobaco.ws/embed/kp/'+id+'" allow="autoplay *" width="500" height="300" allowfullscreen="" webkitallowfullscreen="" mozallowfullscreen="" oallowfullscreen="" msallowfullscreen=""></iframe>');
			return getInfo(id);
		}
	}

	async function getInfo(id) {
		let url = ('https://kinopoiskapiunofficial.tech/api/v2.2/films/' + id +'');
		let response = await fetch(url , {
			method: 'GET',
			headers: {
				"Content-Type": "application/json",
				"X-API-KEY": "4b12f46d-638b-4bac-bf06-33865d3a3524",
			},
		});
		if (response.ok) {
			let data = await response.json();
			console.log(data);
			$('#film-info').append('<input title="Скопировать ссылку" type="button" value="Ссылка &#128279;" class="button" onclick="linkcopy()" style="padding: 4px;margin: -20px 0 10px 0;"> <text style="font-size: 24px;">' + data.nameRu + '</text><br><text style="margin-right: 10px;">' + data.year + '</text><text style="color: #aea">' + data.ratingKinopoisk + '</text><br><text style="bottom: 10px;position: relative;display: block;margin: 10px 0;" class="listDesc">' + data.description + '</text>');
		} else {
			alert('error', response.status);
		}
	}
</script>
</body>
</html>
