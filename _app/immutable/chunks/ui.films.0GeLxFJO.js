import{s as ee,a as ae,c as oe,b as g,d as c,f as u,i as D,g as d,n as U,j as v,q as O,l as F,k,r as T,m as G,a1 as ve,D as K,o as Pe,z as Ae,a3 as Ve,x as Me,t as W,e as ke,h as Le}from"./scheduler.UmdBsXoH.js";import{S as te,i as le,c as X,a as Y,m as Z,t as H,g as fe,b as A,e as ce,d as x}from"./index.Vbt9v2Aa.js";import{p as Re}from"./stores.PkC-A_-y.js";import{g as Se,a as Ue}from"./entry.NUIOFjUy.js";import{o as ue,w as He,e as be,u as Ne,a as Oe,L as Te,s as qe}from"./searchFilm.q046qK5L.js";import"./ui.button.eDEFvkPg.js";import{A as Be}from"./arrow.68QDVyr3.js";import{p as Fe}from"./index.3YLQEot0.js";function Ge(r){let e,l;return{c(){e=ae("svg"),l=ae("path"),this.h()},l(t){e=oe(t,"svg",{width:!0,height:!0,viewBox:!0,fill:!0,xmlns:!0});var s=g(e);l=oe(s,"path",{d:!0,stroke:!0,"stroke-width":!0,"stroke-linecap":!0,"stroke-linejoin":!0}),g(l).forEach(c),s.forEach(c),this.h()},h(){u(l,"d","M14 10V17M10 10V17M6 6V17.8C6 18.9201 6 19.4798 6.21799 19.9076C6.40973 20.2839 6.71547 20.5905 7.0918 20.7822C7.5192 21 8.07899 21 9.19691 21H14.8031C15.921 21 16.48 21 16.9074 20.7822C17.2837 20.5905 17.5905 20.2839 17.7822 19.9076C18 19.4802 18 18.921 18 17.8031V6M6 6H8M6 6H4M8 6H16M8 6C8 5.06812 8 4.60241 8.15224 4.23486C8.35523 3.74481 8.74432 3.35523 9.23437 3.15224C9.60192 3 10.0681 3 11 3H13C13.9319 3 14.3978 3 14.7654 3.15224C15.2554 3.35523 15.6447 3.74481 15.8477 4.23486C15.9999 4.6024 16 5.06812 16 6M16 6H18M18 6H20"),u(l,"stroke","white"),u(l,"stroke-width","2"),u(l,"stroke-linecap","round"),u(l,"stroke-linejoin","round"),u(e,"width","24"),u(e,"height","24"),u(e,"viewBox","0 0 24 24"),u(e,"fill","none"),u(e,"xmlns","http://www.w3.org/2000/svg")},m(t,s){D(t,e,s),d(e,l)},p:U,i:U,o:U,d(t){t&&c(e)}}}class Ke extends te{constructor(e){super(),le(this,e,null,Ge,ee,{})}}function ze(r){let e,l;return{c(){e=ae("svg"),l=ae("path"),this.h()},l(t){e=oe(t,"svg",{width:!0,height:!0,viewBox:!0,fill:!0,xmlns:!0});var s=g(e);l=oe(s,"path",{d:!0,stroke:!0,"stroke-width":!0,"stroke-linecap":!0,"stroke-linejoin":!0}),g(l).forEach(c),s.forEach(c),this.h()},h(){u(l,"d","M1.66699 14.6667H20.3337M1.66699 8.00004H20.3337M1.66699 1.33337H12.3337"),u(l,"stroke","white"),u(l,"stroke-width","2"),u(l,"stroke-linecap","round"),u(l,"stroke-linejoin","round"),u(e,"width","22"),u(e,"height","16"),u(e,"viewBox","0 0 22 16"),u(e,"fill","none"),u(e,"xmlns","http://www.w3.org/2000/svg")},m(t,s){D(t,e,s),d(e,l)},p:U,i:U,o:U,d(t){t&&c(e)}}}class $e extends te{constructor(e){super(),le(this,e,null,ze,ee,{})}}let Je="https://kinopoiskapiunofficial.tech/api/v2.2/films/";async function Qe(r){return r?await(await fetch(`${Je}${r}`,ue)).json():{}}let We="https://kinopoiskapiunofficial.tech/api/v2.2/films/collections";async function Xe(r=1){return await(await fetch(`${We}?page=${r}`,ue)).json()}let Ye="https://kinopoiskapiunofficial.tech/api/v2.2/films",Ze="https://kinopoiskapiunofficial.tech//api/v2.1/films";async function xe(r){if(r){let e=await fetch(`${Ye}/${r}/similars`,ue);e=await e.json();let l=await fetch(`${Ze}/${r}/sequels_and_prequels`,ue);l=await l.json();let t=[...l,...e.items];return t=t.filter((s,a,n)=>a===n.findIndex(i=>i.place===s.place&&i.filmId===s.filmId)),t}return[]}function et(r){let e;return{c(){e=v("span"),this.h()},l(l){e=k(l,"SPAN",{class:!0}),g(e).forEach(c),this.h()},h(){u(e,"class","svelte-g2munl")},m(l,t){D(l,e,t)},p:U,d(l){l&&c(e)}}}function tt(r){let e,l="Кинопоиск:",t,s,a;return{c(){e=v("span"),e.textContent=l,t=O(),s=v("mark"),a=F(r[2]),this.h()},l(n){e=k(n,"SPAN",{class:!0,"data-svelte-h":!0}),Me(e)!=="svelte-tbpxtp"&&(e.textContent=l),t=T(n),s=k(n,"MARK",{class:!0});var i=g(s);a=G(i,r[2]),i.forEach(c),this.h()},h(){u(e,"class","svelte-g2munl"),u(s,"class","svelte-g2munl"),W(s,"okey",r[2]>3.9&&r[2]<7),W(s,"bad",r[2]<4)},m(n,i){D(n,e,i),D(n,t,i),D(n,s,i),d(s,a)},p(n,i){i&4&&K(a,n[2]),i&4&&W(s,"okey",n[2]>3.9&&n[2]<7),i&4&&W(s,"bad",n[2]<4)},d(n){n&&(c(e),c(t),c(s))}}}function we(r){let e,l,t,s,a;return l=new Ke({}),{c(){e=v("button"),X(l.$$.fragment),this.h()},l(n){e=k(n,"BUTTON",{class:!0,title:!0});var i=g(e);Y(l.$$.fragment,i),i.forEach(c),this.h()},h(){u(e,"class","delete svelte-g2munl"),u(e,"title","Удалить")},m(n,i){D(n,e,i),Z(l,e,null),t=!0,s||(a=Ae(e,"click",Ve(r[3])),s=!0)},p:U,i(n){t||(H(l.$$.fragment,n),t=!0)},o(n){A(l.$$.fragment,n),t=!1},d(n){n&&c(e),x(l),s=!1,a()}}}function lt(r){let e,l,t,s,a,n,i,h=(r[0].nameRu||r[0].nameEn||r[0].nameOriginal)+"",o,f,_,j,C=r[0].year+"",M,N,E,V=(r[0].description||"")+"",b,y,p,P,z,L,se,$,B,ne,R;function he(m,I){return m[2]>0?tt:et}let re=he(r),S=re(r),w=r[1]&&we(r);return B=new Be({}),{c(){e=v("a"),l=v("li"),t=v("img"),a=O(),n=v("div"),i=v("h3"),o=F(h),_=O(),j=v("time"),M=F(C),N=O(),E=v("p"),b=F(V),p=O(),P=v("div"),S.c(),z=O(),L=v("div"),w&&w.c(),se=O(),$=v("div"),X(B.$$.fragment),this.h()},l(m){e=k(m,"A",{href:!0,class:!0});var I=g(e);l=k(I,"LI",{class:!0});var J=g(l);t=k(J,"IMG",{src:!0,alt:!0,loading:!0,class:!0}),a=T(J),n=k(J,"DIV",{class:!0});var q=g(n);i=k(q,"H3",{title:!0,class:!0});var me=g(i);o=G(me,h),me.forEach(c),_=T(q),j=k(q,"TIME",{class:!0});var _e=g(j);M=G(_e,C),_e.forEach(c),N=T(q),E=k(q,"P",{title:!0,class:!0});var de=g(E);b=G(de,V),de.forEach(c),p=T(q),P=k(q,"DIV",{});var pe=g(P);S.l(pe),pe.forEach(c),q.forEach(c),z=T(J),L=k(J,"DIV",{class:!0});var ie=g(L);w&&w.l(ie),se=T(ie),$=k(ie,"DIV",{class:!0});var ge=g($);Y(B.$$.fragment,ge),ge.forEach(c),ie.forEach(c),J.forEach(c),I.forEach(c),this.h()},h(){ve(t.src,s=r[0].posterUrlPreview||r[0].posterUrl)||u(t,"src",s),u(t,"alt","Постер"),u(t,"loading","lazy"),t.inert=!0,u(t,"class","svelte-g2munl"),u(i,"title",f=r[0].nameRu||r[0].nameEn||r[0].nameOriginal),u(i,"class","svelte-g2munl"),u(j,"class","svelte-g2munl"),u(E,"title",y=r[0].description||""),u(E,"class","svelte-g2munl"),u(n,"class","text svelte-g2munl"),u($,"class","arrow svelte-g2munl"),u(L,"class","actions svelte-g2munl"),u(l,"class","svelte-g2munl"),u(e,"href",ne=`/watch?id=${r[0].filmId||r[0].id||r[0].kinopoiskId}`),u(e,"class","svelte-g2munl")},m(m,I){D(m,e,I),d(e,l),d(l,t),d(l,a),d(l,n),d(n,i),d(i,o),d(n,_),d(n,j),d(j,M),d(n,N),d(n,E),d(E,b),d(n,p),d(n,P),S.m(P,null),d(l,z),d(l,L),w&&w.m(L,null),d(L,se),d(L,$),Z(B,$,null),R=!0},p(m,[I]){(!R||I&1&&!ve(t.src,s=m[0].posterUrlPreview||m[0].posterUrl))&&u(t,"src",s),(!R||I&1)&&h!==(h=(m[0].nameRu||m[0].nameEn||m[0].nameOriginal)+"")&&K(o,h),(!R||I&1&&f!==(f=m[0].nameRu||m[0].nameEn||m[0].nameOriginal))&&u(i,"title",f),(!R||I&1)&&C!==(C=m[0].year+"")&&K(M,C),(!R||I&1)&&V!==(V=(m[0].description||"")+"")&&K(b,V),(!R||I&1&&y!==(y=m[0].description||""))&&u(E,"title",y),re===(re=he(m))&&S?S.p(m,I):(S.d(1),S=re(m),S&&(S.c(),S.m(P,null))),m[1]?w?(w.p(m,I),I&2&&H(w,1)):(w=we(m),w.c(),H(w,1),w.m(L,se)):w&&(fe(),A(w,1,1,()=>{w=null}),ce()),(!R||I&1&&ne!==(ne=`/watch?id=${m[0].filmId||m[0].id||m[0].kinopoiskId}`))&&u(e,"href",ne)},i(m){R||(H(w),H(B.$$.fragment,m),R=!0)},o(m){A(w),A(B.$$.fragment,m),R=!1},d(m){m&&c(e),S.d(),w&&w.d(),x(B)}}}function ye(r,e,l,t,s,a,n){try{var i=r[a](n),h=i.value}catch(o){return void l(o)}i.done?e(h):Promise.resolve(h).then(t,s)}function st(r){return function(){var e=this,l=arguments;return new Promise(function(t,s){var a=r.apply(e,l);function n(h){ye(a,t,s,n,i,"next",h)}function i(h){ye(a,t,s,n,i,"throw",h)}n(void 0)})}}function nt(r,e,l){let{canDelete:t=!1}=e,{film:s}=e;var a=s.rating||s.ratingKinopoisk;function n(){He.remove(s),Se("")}return Pe(st(function*(){s.description||(l(0,s=yield Qe(s.film_id||s.filmId||s.id||s.kinopoiskId)),l(2,a=s.rating||s.ratingKinopoisk))})),r.$$set=i=>{"canDelete"in i&&l(1,t=i.canDelete),"film"in i&&l(0,s=i.film)},[s,t,a,n]}class rt extends te{constructor(e){super(),le(this,e,nt,lt,ee,{canDelete:1,film:0})}}function Ee(r,e,l){const t=r.slice();return t[4]=e[l],t}function it(r){let e,l,t,s,a,n,i,h=r[3].title+"",o,f,_,j=r[3].text+"",C,M;const N=[ft,ut],E=[];function V(b,y){return b[3].title=="Ничего не найдено"?0:1}return t=V(r),s=E[t]=N[t](r),{c(){e=v("div"),l=v("div"),s.c(),a=O(),n=v("div"),i=v("p"),o=F(h),f=O(),_=v("span"),C=F(j),this.h()},l(b){e=k(b,"DIV",{class:!0});var y=g(e);l=k(y,"DIV",{class:!0});var p=g(l);s.l(p),p.forEach(c),a=T(y),n=k(y,"DIV",{class:!0});var P=g(n);i=k(P,"P",{class:!0});var z=g(i);o=G(z,h),z.forEach(c),f=T(P),_=k(P,"SPAN",{class:!0});var L=g(_);C=G(L,j),L.forEach(c),P.forEach(c),y.forEach(c),this.h()},h(){u(l,"class","visual svelte-mlj3oc"),u(i,"class","svelte-mlj3oc"),u(_,"class","svelte-mlj3oc"),u(n,"class","text svelte-mlj3oc"),u(e,"class","nothing svelte-mlj3oc")},m(b,y){D(b,e,y),d(e,l),E[t].m(l,null),d(e,a),d(e,n),d(n,i),d(i,o),d(n,f),d(n,_),d(_,C),M=!0},p(b,y){let p=t;t=V(b),t!==p&&(fe(),A(E[p],1,1,()=>{E[p]=null}),ce(),s=E[t],s||(s=E[t]=N[t](b),s.c()),H(s,1),s.m(l,null)),(!M||y&8)&&h!==(h=b[3].title+"")&&K(o,h),(!M||y&8)&&j!==(j=b[3].text+"")&&K(C,j)},i(b){M||(H(s),M=!0)},o(b){A(s),M=!1},d(b){b&&c(e),E[t].d()}}}function at(r){let e,l,t=[],s=new Map,a,n=r[0]&&Ie(r),i=be(r[1]);const h=o=>o[4].filmId||o[4].id||o[4].kinopoiskId||o[4].film_id;for(let o=0;o<i.length;o+=1){let f=Ee(r,i,o),_=h(f);s.set(_,t[o]=De(_,f))}return{c(){n&&n.c(),e=O(),l=v("ul");for(let o=0;o<t.length;o+=1)t[o].c();this.h()},l(o){n&&n.l(o),e=T(o),l=k(o,"UL",{class:!0});var f=g(l);for(let _=0;_<t.length;_+=1)t[_].l(f);f.forEach(c),this.h()},h(){u(l,"class","svelte-mlj3oc")},m(o,f){n&&n.m(o,f),D(o,e,f),D(o,l,f);for(let _=0;_<t.length;_+=1)t[_]&&t[_].m(l,null);a=!0},p(o,f){o[0]?n?n.p(o,f):(n=Ie(o),n.c(),n.m(e.parentNode,e)):n&&(n.d(1),n=null),f&6&&(i=be(o[1]),fe(),t=Ne(t,f,h,1,o,i,s,l,Oe,De,null,Ee),ce())},i(o){if(!a){for(let f=0;f<i.length;f+=1)H(t[f]);a=!0}},o(o){for(let f=0;f<t.length;f+=1)A(t[f]);a=!1},d(o){o&&(c(e),c(l)),n&&n.d(o);for(let f=0;f<t.length;f+=1)t[f].d()}}}function ot(r){let e,l='<div class="loader-spin svelte-mlj3oc"></div>';return{c(){e=v("div"),e.innerHTML=l,this.h()},l(t){e=k(t,"DIV",{class:!0,"data-svelte-h":!0}),Me(e)!=="svelte-1en9h6o"&&(e.innerHTML=l),this.h()},h(){u(e,"class","loader svelte-mlj3oc")},m(t,s){D(t,e,s)},p:U,i:U,o:U,d(t){t&&c(e)}}}function ut(r){let e,l;return e=new $e({}),{c(){X(e.$$.fragment)},l(t){Y(e.$$.fragment,t)},m(t,s){Z(e,t,s),l=!0},i(t){l||(H(e.$$.fragment,t),l=!0)},o(t){A(e.$$.fragment,t),l=!1},d(t){x(e,t)}}}function ft(r){let e,l;return e=new Te({}),{c(){X(e.$$.fragment)},l(t){Y(e.$$.fragment,t)},m(t,s){Z(e,t,s),l=!0},i(t){l||(H(e.$$.fragment,t),l=!0)},o(t){A(e.$$.fragment,t),l=!1},d(t){x(e,t)}}}function Ie(r){let e,l;return{c(){e=v("h2"),l=F(r[0]),this.h()},l(t){e=k(t,"H2",{class:!0});var s=g(e);l=G(s,r[0]),s.forEach(c),this.h()},h(){u(e,"class","svelte-mlj3oc")},m(t,s){D(t,e,s),d(e,l)},p(t,s){s&1&&K(l,t[0])},d(t){t&&c(e)}}}function De(r,e){let l,t,s;return t=new rt({props:{film:e[4],canDelete:e[2]}}),{key:r,first:null,c(){l=ke(),X(t.$$.fragment),this.h()},l(a){l=ke(),Y(t.$$.fragment,a),this.h()},h(){this.first=l},m(a,n){D(a,l,n),Z(t,a,n),s=!0},p(a,n){e=a;const i={};n&2&&(i.film=e[4]),n&4&&(i.canDelete=e[2]),t.$set(i)},i(a){s||(H(t.$$.fragment,a),s=!0)},o(a){A(t.$$.fragment,a),s=!1},d(a){a&&c(l),x(t,a)}}}function ct(r){let e,l,t,s,a;const n=[ot,at,it],i=[];function h(o,f){return f&2&&(l=null),l==null&&(l=!Array.isArray(o[1])),l?0:o[1][0]?1:o[3].disable?-1:2}return~(t=h(r,-1))&&(s=i[t]=n[t](r)),{c(){e=v("section"),s&&s.c(),this.h()},l(o){e=k(o,"SECTION",{class:!0});var f=g(e);s&&s.l(f),f.forEach(c),this.h()},h(){u(e,"class","svelte-mlj3oc"),W(e,"disable",Array.isArray(r[1])&&!r[1].length&&r[3].disable)},m(o,f){D(o,e,f),~t&&i[t].m(e,null),a=!0},p(o,[f]){let _=t;t=h(o,f),t===_?~t&&i[t].p(o,f):(s&&(fe(),A(i[_],1,1,()=>{i[_]=null}),ce()),~t?(s=i[t],s?s.p(o,f):(s=i[t]=n[t](o),s.c()),H(s,1),s.m(e,null)):s=null),(!a||f&10)&&W(e,"disable",Array.isArray(o[1])&&!o[1].length&&o[3].disable)},i(o){a||(H(s),a=!0)},o(o){A(s),a=!1},d(o){o&&c(e),~t&&i[t].d()}}}function ht(r,e,l){let{lable:t=""}=e,{list:s}=e,{canDelete:a=!1}=e,{nothing:n={title:"Ничего не найдено",text:"",disable:!1}}=e;return r.$$set=i=>{"lable"in i&&l(0,t=i.lable),"list"in i&&l(1,s=i.list),"canDelete"in i&&l(2,a=i.canDelete),"nothing"in i&&l(3,n=i.nothing)},[t,s,a,n]}class mt extends te{constructor(e){super(),le(this,e,ht,ct,ee,{lable:0,list:1,canDelete:2,nothing:3})}}function _t(r){let e,l;return e=new mt({props:{list:r[1],lable:r[2],nothing:r[0],canDelete:r[3]}}),{c(){X(e.$$.fragment)},l(t){Y(e.$$.fragment,t)},m(t,s){Z(e,t,s),l=!0},p(t,[s]){const a={};s&2&&(a.list=t[1]),s&4&&(a.lable=t[2]),s&1&&(a.nothing=t[0]),s&8&&(a.canDelete=t[3]),e.$set(a)},i(t){l||(H(e.$$.fragment,t),l=!0)},o(t){A(e.$$.fragment,t),l=!1},d(t){x(e,t)}}}var je=1;function Ce(r,e,l,t,s,a,n){try{var i=r[a](n),h=i.value}catch(o){return void l(o)}i.done?e(h):Promise.resolve(h).then(t,s)}function Q(r){return function(){var e=this,l=arguments;return new Promise(function(t,s){var a=r.apply(e,l);function n(h){Ce(a,t,s,n,i,"next",h)}function i(h){Ce(a,t,s,n,i,"throw",h)}n(void 0)})}}function dt(r,e,l){let t;Le(r,Re,p=>l(11,t=p));let{type:s="search"}=e;var a={disable:!0},n,i=[],h="",o=!1;function f(){return _.apply(this,arguments)}function _(){return _=Q(function*(){if(n=Object.fromEntries(t.url.searchParams),n.key){var p=yield qe(n.key,je);l(1,i=p.films),l(2,h="Вот что нашли")}if(n.popular==""){var P=yield Xe(je);l(1,i=P.items),l(2,h="Популярное")}l(0,a={title:"Ничего не найдено",text:"Попробуйте другой запрос для поиска",disable:!1})}),_.apply(this,arguments)}function j(){return C.apply(this,arguments)}function C(){return C=Q(function*(){l(1,i=He.get()),l(0,a={title:"История пуста",text:"Здесь будет список фильмов, которые вы смотрели на своём устройстве",disable:!1}),l(3,o=!0)}),C.apply(this,arguments)}function M(p){return N.apply(this,arguments)}function N(){return N=Q(function*(p){l(1,i=yield Fe.collection("lists").getFullList({sort:"-created",filter:'status = "'+p+'"'})),console.log(i),l(3,o=!1)}),N.apply(this,arguments)}function E(){return V.apply(this,arguments)}function V(){return V=Q(function*(){n=Object.fromEntries(t.url.searchParams);var p=yield xe(n.id);l(1,i=p),l(2,h="Похожие фильмы"),l(0,a={disable:!0})}),V.apply(this,arguments)}function b(p){return y.apply(this,arguments)}function y(){return y=Q(function*(p){switch(l(1,i=void 0),p){case"search":yield f();break;case"history":yield j();break;case"planned":yield M("planned"),l(0,a={title:"Список пуст",text:"",disable:!1});break;case"view":yield M("view"),l(0,a={title:"Список пуст",text:"",disable:!1});break;case"recomends":yield E();break}}),y.apply(this,arguments)}return Ue(Q(function*(){b(s)})),r.$$set=p=>{"type"in p&&l(4,s=p.type)},r.$$.update=()=>{r.$$.dirty&16&&b(s)},[a,i,h,o,s]}class It extends te{constructor(e){super(),le(this,e,dt,_t,ee,{type:4})}}export{It as U,Qe as g};
